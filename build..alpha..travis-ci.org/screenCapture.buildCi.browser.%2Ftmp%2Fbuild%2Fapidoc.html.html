<html><head></head><body><div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a href="https://github.com/sintaxi/surge#readme">surge (v0.19.0)</a>
</h1>
<h4>CDN for front-end developers</h4>
<div class="apidocSectionDiv"><a href="#apidoc.tableOfContents" id="apidoc.tableOfContents"><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.surge">module surge</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.surge">
            function <span class="apidocSignatureSpan"></span>surge
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">surge.</span>discovery</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">surge.</span>helpers</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">surge.</span>index</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.surge.discovery">module surge.discovery</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.discovery.setDomainFromArgs">
            function <span class="apidocSignatureSpan">surge.discovery.</span>setDomainFromArgs
            <span class="apidocSignatureSpan">(req, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.discovery.setDomainFromCname">
            function <span class="apidocSignatureSpan">surge.discovery.</span>setDomainFromCname
            <span class="apidocSignatureSpan">(req, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.discovery.suggestDomainFromCname">
            function <span class="apidocSignatureSpan">surge.discovery.</span>suggestDomainFromCname
            <span class="apidocSignatureSpan">(req, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.discovery.suggestDomainFromGenerator">
            function <span class="apidocSignatureSpan">surge.discovery.</span>suggestDomainFromGenerator
            <span class="apidocSignatureSpan">(req, next)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.surge.helpers">module surge.helpers</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.helpers.fetchToken">
            function <span class="apidocSignatureSpan">surge.helpers.</span>fetchToken
            <span class="apidocSignatureSpan">(endpoint)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.helpers.hr">
            function <span class="apidocSignatureSpan">surge.helpers.</span>hr
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.helpers.log">
            function <span class="apidocSignatureSpan">surge.helpers.</span>log
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.helpers.payment">
            function <span class="apidocSignatureSpan">surge.helpers.</span>payment
            <span class="apidocSignatureSpan">(req, stripe_pk, existing)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.helpers.read">
            function <span class="apidocSignatureSpan">surge.helpers.</span>read
            <span class="apidocSignatureSpan">(opts, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.helpers.stacktrace">
            function <span class="apidocSignatureSpan">surge.helpers.</span>stacktrace
            <span class="apidocSignatureSpan">(str, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.helpers.validDomain">
            function <span class="apidocSignatureSpan">surge.helpers.</span>validDomain
            <span class="apidocSignatureSpan">(domain)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.surge.index">module surge.index</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.index.0">
            function <span class="apidocSignatureSpan">surge.index.</span>0
            <span class="apidocSignatureSpan">(req, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.index.1">
            function <span class="apidocSignatureSpan">surge.index.</span>1
            <span class="apidocSignatureSpan">(req, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.index.10">
            function <span class="apidocSignatureSpan">surge.index.</span>10
            <span class="apidocSignatureSpan">(req, next, abort)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.index.11">
            function <span class="apidocSignatureSpan">surge.index.</span>11
            <span class="apidocSignatureSpan">(req, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.index.12">
            function <span class="apidocSignatureSpan">surge.index.</span>12
            <span class="apidocSignatureSpan">(req, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.index.13">
            function <span class="apidocSignatureSpan">surge.index.</span>13
            <span class="apidocSignatureSpan">(req, next, abort)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.index.14">
            function <span class="apidocSignatureSpan">surge.index.</span>14
            <span class="apidocSignatureSpan">(req, next, abort)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.index.15">
            function <span class="apidocSignatureSpan">surge.index.</span>15
            <span class="apidocSignatureSpan">(req, next, abort)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.index.16">
            function <span class="apidocSignatureSpan">surge.index.</span>16
            <span class="apidocSignatureSpan">(req, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.index.17">
            function <span class="apidocSignatureSpan">surge.index.</span>17
            <span class="apidocSignatureSpan">(req, next, abort)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.index.18">
            function <span class="apidocSignatureSpan">surge.index.</span>18
            <span class="apidocSignatureSpan">(req, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.index.19">
            function <span class="apidocSignatureSpan">surge.index.</span>19
            <span class="apidocSignatureSpan">(req, next, abort)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.index.2">
            function <span class="apidocSignatureSpan">surge.index.</span>2
            <span class="apidocSignatureSpan">(req, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.index.20">
            function <span class="apidocSignatureSpan">surge.index.</span>20
            <span class="apidocSignatureSpan">(req, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.index.21">
            function <span class="apidocSignatureSpan">surge.index.</span>21
            <span class="apidocSignatureSpan">(req, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.index.22">
            function <span class="apidocSignatureSpan">surge.index.</span>22
            <span class="apidocSignatureSpan">(req, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.index.3">
            function <span class="apidocSignatureSpan">surge.index.</span>3
            <span class="apidocSignatureSpan">(req, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.index.4">
            function <span class="apidocSignatureSpan">surge.index.</span>4
            <span class="apidocSignatureSpan">(req, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.index.5">
            function <span class="apidocSignatureSpan">surge.index.</span>5
            <span class="apidocSignatureSpan">(req, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.index.6">
            function <span class="apidocSignatureSpan">surge.index.</span>6
            <span class="apidocSignatureSpan">(req, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.index.7">
            function <span class="apidocSignatureSpan">surge.index.</span>7
            <span class="apidocSignatureSpan">(req, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.index.8">
            function <span class="apidocSignatureSpan">surge.index.</span>8
            <span class="apidocSignatureSpan">(req, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.index.9">
            function <span class="apidocSignatureSpan">surge.index.</span>9
            <span class="apidocSignatureSpan">(req, next, abort)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.surge" id="apidoc.module.surge">module surge</a></h1>


    <h2>
        <a href="#apidoc.element.surge.surge" id="apidoc.element.surge.surge">
        function <span class="apidocSignatureSpan"></span>surge
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">surge = function (config){
  config = config || {}

  var ep = config.endpoint
    ? config.endpoint
    : config.platform ? "https://surge." + config.platform : 'https://surge.surge.sh'

  config.platform = config.platform || "surge.sh"

  var options = {
    alias: {
      p: 'project',
      d: 'domain',
      e: 'endpoint',
      a: 'add',
      r: 'remove'
    },
    default: { e: ep }
  }

  var surge = function(args){
    // will be one of:
    // commander, yargs, process.argv.split(2), OR minimist

    var argv = minimist(args, options)
    var cmd  = argv._[0]

    var commands = ["login", "logout", "whoami", "list", "publish", "teardown", "token", "plus", "ssl"]

    if (commands.indexOf(cmd) !== -1) {
      argv._.shift()
      surge[cmd]({})(argv)
    } else if(config.default &amp;&amp; commands.indexOf(config.default) !== -1 ){
      surge[config.default]({})(argv)
    }
  }

  var stub = function(req, next){ next(); }

  surge.token = function(hooks){
    var hooks = hooks || {}
    var preAuth     = hooks.preAuth       || stub
    var postAuth    = hooks.postAuth      || stub
    var onion = [
      whitelist, endpoint, pkg, help, version, space,
      preAuth, creds, welcome, tokencheck, email, auth, postAuth,
      token, space
    ]
    return function(){
      var argv = parse(arguments[arguments.length -1])
      skin({
        config: config,
        argv: argv,
        read: read
      }, onion)
    }
  }

  surge.login = function(hooks){
    var hooks = hooks || {}
    var preAuth     = hooks.preAuth       || stub
    var postAuth    = hooks.postAuth      || stub
    var onion = [
      whitelist, endpoint, pkg, help, version, space,
      preAuth, creds, welcome, email, auth, postAuth,
      login, space
    ]
    return function(){
      var argv = parse(arguments[arguments.length -1])
      skin({
        config: config,
        argv: argv,
        read: read
      }, onion)
    }
  }

  surge.logout = function(hooks){
    var hooks = hooks || {}
    var onion = [
      whitelist, endpoint, pkg, help, version, space,
      creds, logout, space
    ]
    return function(){
      var argv = parse(arguments[arguments.length -1])
      skin({
        config: config,
        argv: argv,
        read: read
      }, onion)
    }
  }

  surge.publish = function(hooks){
    var hooks = hooks || {}
    var preAuth     = hooks.preAuth       || stub
    var postAuth    = hooks.postAuth      || stub
    var preProject  = hooks.preProject    || stub
    var postProject = hooks.postProject   || stub
    var preSize     = hooks.preSize       || stub
    var postSize    = hooks.postSize      || stub
    var preDomain   = hooks.preDomain     || stub
    var postDomain  = hooks.postDomain    || stub
    var prePublish  = hooks.prePublish    || stub
    var postPublish = hooks.postPublish   || stub
    var onion = [
      whitelist, endpoint, pkg, help, version, space,
      preAuth, creds, welcome, tokencheck, email, auth, postAuth, shorthand,
      preProject, project, postProject,
      preSize, size, postSize,
      preDomain, discovery.setDomainFromCname, discovery.suggestDomainFromGenerator, domain, postDomain,
      prePublish, protocol, deploy, postPublish,
      ipaddress
    ]
    return function(){
      var argv = parse(arguments[arguments.length -1])
      skin({
        config: config,
        argv: argv,
        read: read
      }, onion)
    }
  }

  surge.whoami = function(hooks){
    var hooks = hooks || {}
    var onion = [
      whitelist, endpoint, pkg, help, version, space,
      creds, tokencheck, whoami
    ]
    return function(){
      var argv = parse(arguments[arguments.length -1])
      skin({
        config: config,
        argv: argv,
        read: read
      }, onion)
    }
  }

  surge.list = function(hooks){
    var hooks = hooks || {}
    var preAuth   = hooks.preAuth  || stub
    var postAuth  = hooks.postAuth || stub
    var onion = [
      whitelist, endpoint, pkg, help, version, space,
      preAuth, creds, welcome, tokencheck, email, auth, postAuth,
      list, space
    ]
    return functi ...</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>








</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.surge.discovery" id="apidoc.module.surge.discovery">module surge.discovery</a></h1>


    <h2>
        <a href="#apidoc.element.surge.discovery.setDomainFromArgs" id="apidoc.element.surge.discovery.setDomainFromArgs">
        function <span class="apidocSignatureSpan">surge.discovery.</span>setDomainFromArgs
        <span class="apidocSignatureSpan">(req, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">setDomainFromArgs = function (req, next){
  if (!req.domain &amp;&amp; req.argv._[0]) {
    req.domain = req.argv._[0]
  }
  return next()
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.discovery.setDomainFromCname" id="apidoc.element.surge.discovery.setDomainFromCname">
        function <span class="apidocSignatureSpan">surge.discovery.</span>setDomainFromCname
        <span class="apidocSignatureSpan">(req, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">setDomainFromCname = function (req, next){
  if (!req.domain &amp;&amp; !req.suggestedDomain) {

    try {
      var cname = fs.readFileSync(path.join(req.project || process.cwd(), "CNAME")).toString()
      req.domain = cname.split(os.EOL)[0].trim()
    } catch(e) {}
  }
  return next()
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.discovery.suggestDomainFromCname" id="apidoc.element.surge.discovery.suggestDomainFromCname">
        function <span class="apidocSignatureSpan">surge.discovery.</span>suggestDomainFromCname
        <span class="apidocSignatureSpan">(req, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">suggestDomainFromCname = function (req, next){

  if (!req.domain &amp;&amp; !req.suggestedDomain) {
    try {
      var cname = fs.readFileSync(path.join(req.project || process.cwd(), "CNAME")).toString()
      req.suggestedDomain = cname.split(os.EOL)[0].trim()
    }
    catch(e) {
      // console.log(e) // This will produce a visible error when thereâ€™s no CNAME file
    }
  }

  return next()
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.discovery.suggestDomainFromGenerator" id="apidoc.element.surge.discovery.suggestDomainFromGenerator">
        function <span class="apidocSignatureSpan">surge.discovery.</span>suggestDomainFromGenerator
        <span class="apidocSignatureSpan">(req, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">suggestDomainFromGenerator = function (req, next){
  if (!req.domain &amp;&amp; !req.suggestedDomain) {
    req.suggestedDomain = [moniker.choose(), req.config.platform].join(".")
  }
  return next()
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.surge.helpers" id="apidoc.module.surge.helpers">module surge.helpers</a></h1>


    <h2>
        <a href="#apidoc.element.surge.helpers.fetchToken" id="apidoc.element.surge.helpers.fetchToken">
        function <span class="apidocSignatureSpan">surge.helpers.</span>fetchToken
        <span class="apidocSignatureSpan">(endpoint)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">fetchToken = function (endpoint){
  return function(email, pass, callback){
    var options = {
      'url': url.resolve(urlAddy.parse(endpoint).format(), '/token'),
      'method': 'post',
      'auth': {
        'user': email,
        'pass': pass || "",
        'sendImmediately': true
      }
    }
    request(options, function(e, r, obj){
      if (e) throw e

      if(r.statusCode == 417){
        console.log()
        console.log("     Update Required".yellow, "-", obj)
        console.log()
        process.exit(1)
      } else if(r.statusCode == 401){
        var obj = JSON.parse(obj)
        return callback(obj, null)
      }else{
        try {
          var obj = JSON.parse(obj)
          var c   = localCreds(endpoint).set(obj.email, obj.token.replace(os.EOL, ""))
          return callback(null, c)
        } catch(e){
          return callback({"messages": ["password required"]})
        }

      }
    })
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
      prompt: label,
      silent: true,
      edit: false,
      output: out,
      input: req.config.input
    }, function(err, password){
      if (password === undefined) return abort("not authenticated.")
      helpers.<span class="apidocCodeKeywordSpan">fetchToken</span>(req.argv.endpoint || req.config.endpoint || 'surge.'
; + req.config.platform)(req.email, password, function(err, obj){
        if (err) {
count++
if (err.hasOwnProperty("details") &amp;&amp; err["details"].hasOwnProperty("email")) process.exit
(1)

if (count &gt;=3) {
  req.read({
    prompt: "    forgot password?".grey,
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.helpers.hr" id="apidoc.element.surge.helpers.hr">
        function <span class="apidocSignatureSpan">surge.helpers.</span>hr
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">hr = function (){
  this.log()
  return this
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

var helpers     = require("./util/helpers.js")

module.exports = function(req, next){
if (req.creds == null) {
  helpers.log("    Welcome to " + (req.config.name || "Surge").bold + "! (" + req.config.platform +&amp;#
x22;)" )
  if (req.config.name) {
    helpers.log("    Powered by Surge".grey).<span class="apidocCodeKeywordSpan">hr</span>()
  }
  helpers.log("    Please login or create an account by entering your email and password:").hr()
} else {
  if(req.config.name){
    helpers.log("    " + req.config.name.bold + " - " + (req.config.platform || "surge.sh"))
    helpers.log("    Powered by Surge".grey)
  } else {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.helpers.log" id="apidoc.element.surge.helpers.log">
        function <span class="apidocSignatureSpan">surge.helpers.</span>log
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">log = function (){
  var args = Array.prototype.slice.call(arguments)
  args.unshift(sig)
  args = args.filter(function(n){ return n != undefined });
  console.log.apply(console, args)
  return this
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
#!/usr/bin/env node

var surge = require("../")({ default: "publish" })

surge(process.argv.slice(2))

process.on('SIGINT', function() {
  console.<span class="apidocCodeKeywordSpan">log</span>("\n")
  global.ponr == true
    ? console.log("    Disconnected".green, "-", "Past point of no return, completing in background."
;)
    : console.log("    Cancelled".yellow, "-", "Upload aborted, publish not initiated.")
  console.log()
  process.exit(1)
})
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.helpers.payment" id="apidoc.element.surge.helpers.payment">
        function <span class="apidocSignatureSpan">surge.helpers.</span>payment
        <span class="apidocSignatureSpan">(req, stripe_pk, existing)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">payment = function (req, stripe_pk, existing){
  function card(cc, ep, cv, cb){
    read({
      silent: false,
      prompt: "        card number:".grey,
      default: cc,
      edit: true,
    }, function(er, cc){
      if (cc === undefined) return abort("Payment not received.")
      read({
        prompt: "        exp (mo/yr):".grey,
        default: ep,
        edit: true,
      }, function(er, ep){
        if (ep === undefined) return abort("Payment not received.")
        read({
          prompt: "                cvc:".grey,
          default: cv,
          edit: true,
        }, function(er, cv){
          if (cv === undefined) return abort("Payment not received.")
          request({
            uri: "https://"+ stripe_pk +":@api.stripe.com/v1/tokens",
            method: "POST",
            form: {
              card: {
                number: cc,
                exp_month: ep.split("/")[0],
                exp_year: ep.split("/")[1],
                cvc: cv
              }
            }
          }, function(e,r,b) {
            //console.log("POST TOKEN RSP:", r.statusCode)
            if (r.statusCode == 417){
              console.log()
              console.log("     Update Required".yellow, "-", obj)
              console.log()
              process.exit(1)
            } else if (r.statusCode == 402){
              var data = JSON.parse(b)
              var msg = "Card appears to be invalid"

              if (data.hasOwnProperty("error"))
                msg = data["error"]["param"] + " appears to be invalid. "

              msg += "Please try again."
              msg = msg.charAt(0).toUpperCase() + msg.substring(1)

              log()
              log("      ", msg.yellow)
              return card(cc, ep, cv, cb)
            } else if(r.statusCode == 200) {
              var data = JSON.parse(b)
              return cb(data.id)
            }
          })

        })
      })
    })
  }

  if (existing !== null) {
    return function(callback){
      read({
        prompt: ("      Would you like to charge " +  existing.brand + " ending in " + existing.last4.yellow + "?".blue).blue,
        default: "yes",
        edit: true
      }, function(err, reply){
        if (err) console.log(err)

        if (reply === undefined) return abort("Payment not received.")
        if (["Y", "y", "Yes", "yes"].indexOf(reply) !== -1){
          callback(null)
        } else {
          log()
          log("      Please enter new payment method..." + " [all payment transfers are PCI compliant]".grey)
          card("", "", "", callback)
        }
      })
    }
  } else {
    return function(callback){
      log()
      log("      Please enter your payment info..." + " [all payment transfers are PCI compliant]".grey)
      card("", "", "", callback)
    }
  }

}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  payload.perks.forEach(function(perk){
    helpers.log(("          - " + perk).blue)
  })
} else {
  helpers.log(msg)
}

helpers.<span class="apidocCodeKeywordSpan">payment</span>(req, payload["stripe_pk"], payload.card)(function(token){
  //console.log(token)
  var uri = url.resolve(req.endpoint, req.domain + "/subscription")
  request({
    uri: uri,
    method: "PUT",
    auth: {
      'user': 'token',
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.helpers.read" id="apidoc.element.surge.helpers.read">
        function <span class="apidocSignatureSpan">surge.helpers.</span>read
        <span class="apidocSignatureSpan">(opts, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function read(opts, cb) {
  if (opts.num) {
    throw new Error('read() no longer accepts a char number limit')
  }

  if (typeof opts.default !== 'undefined' &amp;&amp;
      typeof opts.default !== 'string' &amp;&amp;
      typeof opts.default !== 'number') {
    throw new Error('default value must be string or number')
  }

  var input = opts.input || process.stdin
  var output = opts.output || process.stdout
  var prompt = (opts.prompt || '').trim() + ' '
  var silent = opts.silent
  var editDef = false
  var timeout = opts.timeout

  var def = opts.default || ''
  if (def) {
    if (silent) {
      prompt += '(&lt;default hidden&gt;) '
    } else if (opts.edit) {
      editDef = true
    } else {
      prompt += '(' + def + ') '
    }
  }
  var terminal = !!(opts.terminal || output.isTTY)

  var m = new Mute({ replace: opts.replace, prompt: prompt })
  m.pipe(output, {end: false})
  output = m
  var rlOpts = { input: input, output: output, terminal: terminal }

  if (process.version.match(/^v0\.6/)) {
    var rl = readline.createInterface(rlOpts.input, rlOpts.output)
  } else {
    var rl = readline.createInterface(rlOpts)
  }


  output.unmute()
  rl.setPrompt(prompt)
  rl.prompt()
  if (silent) {
    output.mute()
  } else if (editDef) {
    rl.line = def
    rl.cursor = def.length
    rl._refreshLine()
  }

  var called = false
  rl.on('line', onLine)
  rl.on('error', onError)

  rl.on('SIGINT', function () {
    rl.close()
    onError(new Error('canceled'))
  })

  var timer
  if (timeout) {
    timer = setTimeout(function () {
      onError(new Error('timed out'))
    }, timeout)
  }

  function done () {
    called = true
    rl.close()

    if (process.version.match(/^v0\.6/)) {
      rl.input.removeAllListeners('data')
      rl.input.removeAllListeners('keypress')
      rl.input.pause()
    }

    clearTimeout(timer)
    output.mute()
    output.end()
  }

  function onError (er) {
    if (called) return
    done()
    return cb(er)
  }

  function onLine (line) {
    if (called) return
    if (silent &amp;&amp; terminal) {
      output.unmute()
      output.write('\r\n')
    }
    done()
    // truncate the \n at the end.
    line = line.replace(/\r?\n$/, '')
    var isDefault = !!(editDef &amp;&amp; line === def)
    if (def &amp;&amp; !line) {
      isDefault = true
      line = def
    }
    cb(null, line, isDefault)
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  var count = 0
  var label = "           password:".grey

  var auth = function(){
var out = req.config.output
if (out) out.isTTY = false

req.<span class="apidocCodeKeywordSpan">read</span>({
  prompt: label,
  silent: true,
  edit: false,
  output: out,
  input: req.config.input
}, function(err, password){
  if (password === undefined) return abort("not authenticated.")
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.helpers.stacktrace" id="apidoc.element.surge.helpers.stacktrace">
        function <span class="apidocSignatureSpan">surge.helpers.</span>stacktrace
        <span class="apidocSignatureSpan">(str, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">stacktrace = function (str, options){
  var lineno  = options.lineno  || -1
  var context = options.context || 8
  var context = context = context / 2
  var lines   = (os.EOL + str).split(os.EOL)
  var start   = Math.max(lineno - context, 1)
  var end     = Math.min(lines.length, lineno + context)

  if(lineno === -1) end = lines.length

  var pad     = end.toString().length

  var context = lines.slice(start, end).map(function(line, i){
    var curr = i + start
    return (curr == lineno ? ' &gt; ' : '   ')
      + Array(pad - curr.toString().length + 1).join(' ')
      + curr
      + '| '
      + line
  }).join(os.EOL)

  return context
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...


if (payload.hasOwnProperty("type") &amp;&amp; payload.type === "error") {
  console.log()
  console.log()
  helpers.log("   Processing Error:".yellow, payload.error.filename).log()

  console.log(helpers.<span class="apidocCodeKeywordSpan">stacktrace</span>(payload.error.stack, { lineno: payload.error.lineno }))
  helpers.log()
  console.log("  ", payload.error.message)

  console.log()
  process.exit(1)
  req.status = req.status || "Compile Error"
} else
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.helpers.validDomain" id="apidoc.element.surge.helpers.validDomain">
        function <span class="apidocSignatureSpan">surge.helpers.</span>validDomain
        <span class="apidocSignatureSpan">(domain)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">validDomain = function (domain) {
  if (domain &amp;&amp; (isDomain(domain) === true || isDomain(urlAddy(domain).host) === true)) {
    return true
  } else {
    return false
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
module.exports = function(req, next, abort){
var label = "             domain:".grey

// try {
//   req.domain = req.argv.domain || fs.readFileSync(path.join(req.project, "CNAME")).toString()
//   req.domain = req.domain.split(os.EOL)[0].trim()

//   if (!helpers.<span class="apidocCodeKeywordSpan">validDomain</span>(req.domain)) {
//     return getDomain(req.domain, next)
//   } else {
//     console.log(label, req.domain)
//     return next()
//   }
// } catch(e) {
//   return getDomain(moniker.choose() + ".surge.sh")   // prompt with a suggestion
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.surge.index" id="apidoc.module.surge.index">module surge.index</a></h1>


    <h2>
        <a href="#apidoc.element.surge.index.0" id="apidoc.element.surge.index.0">
        function <span class="apidocSignatureSpan">surge.index.</span>0
        <span class="apidocSignatureSpan">(req, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">0 = function (req, next){
  var commands = ['h','b', 'd','e','a','r','v','V','p','endpoint','project','domain','add','remove','version','verbose','token','
help','pem', 'build','$0','_'];

  var args = [];
  for (param in req.argv) {
    args.push(param);
  }

  var filteredSet = args.filter(function(n){ return (commands.indexOf(n) === -1) });

  if (filteredSet.length != 0) {
    helpers.log()
    helpers.log("       surge: `--" + filteredSet[0] + "` is not a surge command.").hr()
  } else {
    next()
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.index.1" id="apidoc.element.surge.index.1">
        function <span class="apidocSignatureSpan">surge.index.</span>1
        <span class="apidocSignatureSpan">(req, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">1 = function (req, next){
  req.endpoint = parse(req.argv.endpoint || req.config.endpoint || "surge." + req.config.platform)
  next()
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.index.10" id="apidoc.element.surge.index.10">
        function <span class="apidocSignatureSpan">surge.index.</span>10
        <span class="apidocSignatureSpan">(req, next, abort)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">10 = function (req, next, abort){
  var count = 0
  var label = "           password:".grey

  var auth = function(){
    var out = req.config.output
    if (out) out.isTTY = false

    req.read({
      prompt: label,
      silent: true,
      edit: false,
      output: out,
      input: req.config.input
    }, function(err, password){
      if (password === undefined) return abort("not authenticated.")
      helpers.fetchToken(req.argv.endpoint || req.config.endpoint || 'surge.' + req.config.platform)(req.email, password, function
(err, obj){
        if (err) {
          count++
          if (err.hasOwnProperty("details") &amp;&amp; err["details"].hasOwnProperty("email")) process.exit(1)

          if (count &gt;=3) {
            req.read({
              prompt: "    forgot password?".grey,
              default: "yes",
              terminal: req.config.terminal,
              output: req.config.output,
              input: req.config.input
            }, function(err, reply){
              if (reply == "yes" || reply == "y" || reply == "Y") {

                var options = {
                  'url': url.resolve(req.endpoint, "/token/reset/" + req.email),
                  'method': 'post'
                }

                request(options, function(e, r, obj){
                  if (e) throw e
                  if (r.statusCode == 201) {
                    console.log()
                    console.log("    Password Recovery".yellow, "- reset instructions sent to", req.email.green)
                    console.log()
                    process.exit(1)
                  } else {
                    console.log()
                    console.log("    Oops".red, "- something went wrong trying to reset your password.")
                    console.log()
                    process.exit(1)
                  }
                })
              } else {
                console.log()
                console.log("    Aborted".yellow, "- no password reset sent.", req.email.green)
                console.log()
                process.exit(1)
              }


            })
          } else {
            return auth()
          }
        } else {
          req.creds = localCreds(req.argv.endpoint || req.config.endpoint || 'surge.' + req.config.platform).set(obj.email, obj.
token)
          return next()
        }
      })
    })
  }

  if (req.authed) {
    console.log("              token:".grey, "*****************".grey)
    return next()
  } else {
    return auth()
  }

}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.index.11" id="apidoc.element.surge.index.11">
        function <span class="apidocSignatureSpan">surge.index.</span>11
        <span class="apidocSignatureSpan">(req, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">11 = function (req, next){
  helpers.log()
  helpers.log("    Logged in as " + req.creds.email.green + ".")
  next()

  //helpers.log("              token: ".grey + req.creds.token)

}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.index.12" id="apidoc.element.surge.index.12">
        function <span class="apidocSignatureSpan">surge.index.</span>12
        <span class="apidocSignatureSpan">(req, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">12 = function (req, next){

  var options = {
    'url': url.resolve(req.endpoint, '/list'),
    'method': 'get',
    'auth': {
      'user': "token",
      'pass': req.creds.token,
      'sendImmediately': true
    }
  }

  request(options, function(e, r, obj){
    if (e) throw e
    var list = JSON.parse(obj)
    console.log()
    if (list.length != 0) {
      list.forEach(function(project){
        console.log("      " + project)
      })
    } else {
      console.log("    Empty".yellow, "- No Projects found.")
    }
    next()
  })

}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.index.13" id="apidoc.element.surge.index.13">
        function <span class="apidocSignatureSpan">surge.index.</span>13
        <span class="apidocSignatureSpan">(req, next, abort)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">13 = function (req, next, abort){

  var plus = function(domain){
    var options = {
      'url': url.resolve(req.endpoint, domain + "/subscription"),
      'method': 'get',
      'auth': {
        'user': "token",
        'pass': req.creds.token,
        'sendImmediately': true
      }
    }

    request(options, function(e, r, obj){
      if (e) throw e

      var payload = JSON.parse(obj)

      var msg = "      Project requires the ".blue  + payload.plan.name.yellow + " plan. ".blue + ("$" + (payload.plan.amount /
100) + "/mo").yellow + " (cancel anytime).".blue

      helpers.log()
      if (payload.hasOwnProperty("perks")) {
        helpers.log(msg += " This plan provides...".blue)
        payload.perks.forEach(function(perk){
          helpers.log(("          - " + perk).blue)
        })
      } else {
        helpers.log(msg)
      }

      helpers.payment(req, payload["stripe_pk"], payload.card)(function(token){
        var uri = url.resolve(req.endpoint, domain + "/subscription")
        request({
          uri: uri,
          method: "PUT",
          auth: {
            'user': 'token',
            'pass': req.creds.token,
            'sendImmediately': true
          },
          form: {
            plan: payload.plan,
            token: token
          }
        }, function(e,r,b){
          if (r.statusCode == 201) {
            if (token === null) console.log()
            var sub = JSON.parse(b)
            console.log("               plan:".grey, sub.plan.name)
            console.log()
            console.log(("      You are now upgraded to " + sub.plan.name + "!").green)
            console.log()
          } else if (r.statusCode == 200) {
            var sub = JSON.parse(b)
            console.log("               plan:".grey, sub.plan.name)
            console.log()
            console.log(("      No charge created. You are already upgraded to " + sub.plan.name + "!").green)
            console.log()
          } else {
            console.log(r.statusCode)
          }
        })
      })
      //process.exit()
    })

  }

  return plus(parseUrl(req.domain).hostname)

}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.index.14" id="apidoc.element.surge.index.14">
        function <span class="apidocSignatureSpan">surge.index.</span>14
        <span class="apidocSignatureSpan">(req, next, abort)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">14 = function (req, next, abort){

    var upload = function(req, next, abort){
      var uri = url.resolve(req.endpoint, path.join(req.domain, "ssl"))
      var handshake = request.put(uri, { "version" : req.pkg.version })

      // apply basic auth
      handshake.auth("token", req.creds.token, true)

      // catch errors
      handshake.on('error', function(d){
        console.log(d)
      })

      // split replies on new line
      handshake.pipe(split())

      // output result
      handshake.on("data", function(data){
        var payload = JSON.parse(data.toString())
        if (payload.hasOwnProperty("type") &amp;&amp; payload["type"] == "collect"){
          var msg = "      Project requires the ".blue  + payload.plan.name.yellow + " plan. ".blue + ("$" + (payload.plan.amount
 / 100) + "/mo").yellow + " (cancel anytime).".blue
          helpers.log()
          if (payload.hasOwnProperty("perks")) {
            helpers.log(msg += " This plan provides...".blue)
            payload.perks.forEach(function(perk){
              helpers.log(("          - " + perk).blue)
            })
          } else {
            helpers.log(msg)
          }
          helpers.payment(req, payload["stripe_pk"], payload.card)(function(token){
            var uri = url.resolve(req.endpoint, req.domain + "/subscription")
            request({
              uri: uri,
              method: "PUT",
              auth: {
                'user': 'token',
                'pass': req.creds.token,
                'sendImmediately': true
              },
              form: {
                plan: payload.plan,
                token: token
              }
            }, function(e,r,b){
              if (r.statusCode == 201) {
                //if (token === null) console.log()
                //next()
                //var sub = JSON.parse(b)
                //console.log("               plan:".grey, sub.plan.name)
              }
            })
          })
        } else if (payload.hasOwnProperty("type") &amp;&amp; payload["type"] == "subscription"){
          // if (payload.data) {
          //   console.log("               plan:".grey, payload.data.plan.name)
          // } else {
          //   console.log("               plan:".grey, "Free")
          // }
        } else if (payload.hasOwnProperty("type") &amp;&amp; payload["type"] == "msg"){
          console.log()
          if (payload.payload["status"] == "ok") {
            console.log("    Success".green, "-", payload.payload["msg"])
          } else {
            console.log("    Error".yellow, "-", payload.payload["msg"])
          }
          console.log()
        }

      })

      // done
      handshake.on("end", function(){
        // console.log()
        // console.log("   Success!".green, "-", "ssl cert has been added to", req.domain)
        // console.log()
        // process.exit()
      })

      handshake.on("response", function(rsp){
        console.log()
        // if (rsp.statusCode == 403) {
        //   helpers.log()
        //   helpers.log("    Unauthorized".yellow + " - you do not have publish access to", req.domain)
        //   helpers.log()
        //   process.exit()
        // } else if (rsp.statusCode == 400) {
        //   helpers.log()
        //   helpers.log("    SSL Fail".red, "-", "pem file is invalid.")
        //   helpers.log()
        //   process.exit()
        // } else if (rsp.statusCode == 202) {
        //   helpers.log()
        //   helpers.log("    SSL Pass".green, "-", "your pem file has been added to", req.domain)
        //   helpers.log()
        //   process.exit()
        // }
      })

      var pem = fs.createReadStream(req.pem)
      pem.pipe(handshake)
    }


    var mPem = function(req, next, abort){
      var label = "           pem file:".grey
      var pemPath
      var getPem = function(placeholder){
        req.read({
          prompt: label,
          default: placeholder,
          edit: true,
          terminal: req.config.terminal,
          output: req.config.output,
          input: req.config.input
        }, function(err, pem){
          if ...</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.index.15" id="apidoc.element.surge.index.15">
        function <span class="apidocSignatureSpan">surge.index.</span>15
        <span class="apidocSignatureSpan">(req, next, abort)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">15 = function (req, next, abort){

  var remove = function(domain){
    var options = {
      'url': url.resolve(req.endpoint, domain),
      'method': 'delete',
      'auth': {
        'user': "token",
        'pass': req.creds.token,
        'sendImmediately': true
      }
    }

    request(options, function(e, r, obj){
      if (e) throw e

      if (r.statusCode == 200 || r.statusCode == 204 || r.statusCode == 210) {
        helpers.log()
        helpers.log("    Success".green + " - " + domain + " has been removed.")
        helpers.log()
        process.exit()
      } else if (r.statusCode == 403) {
        helpers.log()
        helpers.log("    Aborted".yellow + " - unable to remove", domain)
        helpers.log()
        process.exit(1)
      } else {
        helpers.log()
        helpers.log(obj)
        helpers.log()
        process.exit()
      }
    })
  }

  return remove(parseUrl(req.domain).host)

}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.index.16" id="apidoc.element.surge.index.16">
        function <span class="apidocSignatureSpan">surge.index.</span>16
        <span class="apidocSignatureSpan">(req, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">16 = function (req, next){
  req.project = req.argv.project || req.argv.p || req.argv["_"][0] || null
  req.domain  = req.argv.domain  || req.argv.d || req.argv["_"][1] || null
  next()
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.index.17" id="apidoc.element.surge.index.17">
        function <span class="apidocSignatureSpan">surge.index.</span>17
        <span class="apidocSignatureSpan">(req, next, abort)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">17 = function (req, next, abort){
  var label = "       project path:".grey

  if (req.project || req.argv.project || req.argv["_"][0]) {
    req.project = req.project || path.resolve(req.argv.project || req.argv["_"][0] || "")

    fs.exists(req.project, function(exists){
      if (exists) {
        helpers.log("       project path:".grey, req.project)
        next()
      } else {
        helpers.log()
        helpers.log("    Aborted".yellow, "-", "No such file or directory.")
        helpers.log("   ", req.project.red)
        helpers.log()
        process.exit(1)
      }
    })
  } else {
    var ask = function(suggestion){
      req.read({
        silent: false,
        prompt: label,
        default: suggestion,
        edit: true,
        terminal: req.config.terminal,
        output: req.config.output,
        input: req.config.input
      }, function(err, projectPath){
        if (projectPath === undefined) return abort("publishing not initiated.")
        if (!fs.existsSync(path.resolve(projectPath))){
          console.log("                    ", "please enter valid project path...".grey)
          return ask(projectPath)
        } else {
          req.project = path.resolve(projectPath)
          return next()
        }
      })
    }

    var x = path.resolve("./")
    return ask(path.join(x, path.sep))
  }

}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.index.18" id="apidoc.element.surge.index.18">
        function <span class="apidocSignatureSpan">surge.index.</span>18
        <span class="apidocSignatureSpan">(req, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">18 = function (req, next){
  //process.stdout.write("               size:".grey, "checking...")
  process.stdout.write("               size: ".grey)

  req.projectSize = 0;
  req.fileCount = 0
  var project = fsReader({ 'path': req.project, ignoreFiles: [".surgeignore"] })
  project.addIgnoreRules(ignore)

  project.on("child", function (c) {
    fs.lstat(c.path, function(err, stats) {
      req.projectSize += stats.size
      if (!stats.isDirectory()) req.fileCount++
    })
  }).on("close", function(){
    helpers.log(req.fileCount + " files,", humanFileSize(req.projectSize))
    next()
  })

}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.index.19" id="apidoc.element.surge.index.19">
        function <span class="apidocSignatureSpan">surge.index.</span>19
        <span class="apidocSignatureSpan">(req, next, abort)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">19 = function (req, next, abort){
  var label = "             domain:".grey

  // try {
  //   req.domain = req.argv.domain || fs.readFileSync(path.join(req.project, "CNAME")).toString()
  //   req.domain = req.domain.split(os.EOL)[0].trim()

  //   if (!helpers.validDomain(req.domain)) {
  //     return getDomain(req.domain, next)
  //   } else {
  //     console.log(label, req.domain)
  //     return next()
  //   }
  // } catch(e) {
  //   return getDomain(moniker.choose() + ".surge.sh")   // prompt with a suggestion
  // }

  function getDomain(suggestion){
    helpers.read({
      silent: false,
      prompt: label,
      default: suggestion || "",
      edit: true,
      terminal: req.config.terminal,
      output: req.config.output,
      input: req.config.input
    }, function(err, domain){
      if (domain === undefined) return abort("Please try again with a valid domain name.")
      if (err || !helpers.validDomain(domain)) {
        console.log("                    ", "Please enter valid domain nameâ€¦".grey)
        return getDomain(domain)
      }
      req.domain = domain
      return next()
    })
  }

  if (helpers.validDomain(req.domain)) {
    console.log(label, req.domain)
    next()
  } else {
    if (req.domain == "_"){
      req.domain = [moniker.choose(), req.config.platform].join(".")
      console.log(label, req.domain)
      next()
    } else {
      getDomain(req.suggestedDomain)
    }

  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.index.2" id="apidoc.element.surge.index.2">
        function <span class="apidocSignatureSpan">surge.index.</span>2
        <span class="apidocSignatureSpan">(req, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">2 = function (req, next){
  req.pkg = require(__dirname + "/../../package.json")
  next()
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.index.20" id="apidoc.element.surge.index.20">
        function <span class="apidocSignatureSpan">surge.index.</span>20
        <span class="apidocSignatureSpan">(req, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">20 = function (req, next){
  req.ssl = null
  var u   = url.parse(req.domain)

  if (u.protocol !== null) {
    if (u.protocol == "https:") req.ssl = true
    if (u.protocol == "http:") req.ssl = false
    req.domain = u.hostname
  }

  next()
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.index.21" id="apidoc.element.surge.index.21">
        function <span class="apidocSignatureSpan">surge.index.</span>21
        <span class="apidocSignatureSpan">(req, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">21 = function (req, next){


<span class="apidocCodeCommentSpan">  /**
   * Some useful metadata
   */
</span>
  var headers = {
    "version" : req.pkg.version,
    "file-count": req.fileCount,
    "project-size": req.projectSize
  }


  /**
   * Collaborators to add
   */

  if (req.argv.a)
    headers["add"] = req.argv.a;


  /**
   * Collaborators to remove
   */

  if (req.argv.r)
    headers["rem"] = req.argv.r;


  /**
   * Perform build on server
   */

  if (req.argv.build)
    headers["build"] = req.argv.build;


  /**
   * Force Protocol?
   */

  if (req.ssl !== null)
    headers["ssl"] = req.ssl

  /**
   * Progress Bars
   */

  var progress = {}


  /**
   * Our upload "data" handle
   */

  var tick = function(tick){
    if (Object.keys(progress).length &gt; 1) global.ponr = true

    //try {

      try {
        var payload  = JSON.parse(tick.toString())
      } catch(e) {
        //console.log(e)
        return;
      }


      if (payload.hasOwnProperty("type") &amp;&amp; payload.type === "error") {
        console.log()
        console.log()
        helpers.log("   Processing Error:".yellow, payload.error.filename).log()

        console.log(helpers.stacktrace(payload.error.stack, { lineno: payload.error.lineno }))
        helpers.log()
        console.log("  ", payload.error.message)

        console.log()
        process.exit(1)
        req.status = req.status || "Compile Error"
      } else

      if (payload.hasOwnProperty("type") &amp;&amp; payload.type === "users") {
        helpers.log("              users:".grey, payload.users.join(", "))
      } else

      if (payload.hasOwnProperty("type") &amp;&amp; payload.type === "collect") {
        var msg = "      Project requires the ".blue  + payload.plan.name.yellow + " plan. ".blue + ("$" + (payload.plan.amount /
100) + "/mo").yellow + " (cancel anytime).".blue

        helpers.log()
        if (payload.hasOwnProperty("perks")) {
          helpers.log(msg += " This plan provides...".blue)
          payload.perks.forEach(function(perk){
            helpers.log(("          - " + perk).blue)
          })
        } else {
          helpers.log(msg)
        }

        helpers.payment(req, payload["stripe_pk"], payload.card)(function(token){
          //console.log(token)
          var uri = url.resolve(req.endpoint, req.domain + "/subscription")
          request({
            uri: uri,
            method: "PUT",
            auth: {
              'user': 'token',
              'pass': req.creds.token,
              'sendImmediately': true
            },
            form: {
              plan: payload.plan,
              token: token
            }
          }, function(e,r,b){
            if (r.statusCode == 201 || r.statusCode == 200) {
              console.log()
              //if (token === null) console.log()
              //var sub = JSON.parse(b)
              //console.log("               plan:".grey, sub.plan.name)
            }
          })
        })

        // prompt for user
      } else
      if (payload.hasOwnProperty("type") &amp;&amp; payload.type === "ip") {
        if (payload.data) {
          console.log("         IP Address:".grey, payload.data.ip)
        }
      } else
      if (payload.hasOwnProperty("type") &amp;&amp; payload.type === "event_registration") {
        if (payload.data) {
          console.log()
          console.log(("             " + payload.data.event.name + " is set!").bold)

          if (payload.data.event.start)
            console.log("              start:".grey, payload.data.event.start)

          if (payload.data.event.end)
            console.log("                end:".grey, payload.data.event.end)

          if (payload.data.event.website)
            console.log("            website:".grey, payload.data.event.website)

          if (payload.data.event.email)
            console.log("              email:".grey, payload.data.event.email)

          if (payload.data.event.twitter)
            console.log("            twitter:".grey, payload.data.event.twitter)
        }
      } else


      if (payload.hasOwnProperty("type") &amp;&amp; payload.type === "event_participant") { ...</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.index.22" id="apidoc.element.surge.index.22">
        function <span class="apidocSignatureSpan">surge.index.</span>22
        <span class="apidocSignatureSpan">(req, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">22 = function (req, next){

  if (req.status) {

  } else {
    console.log()
    console.log("    Success!".green + " Project is published and running at " + req.domain.green.underline)
    console.log("")
  }

  next()
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.index.3" id="apidoc.element.surge.index.3">
        function <span class="apidocSignatureSpan">surge.index.</span>3
        <span class="apidocSignatureSpan">(req, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">3 = function (req, next){
  if (req.argv.version || req.argv.V) {
    console.log(pkg.version)
  } else {
    next()
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.index.4" id="apidoc.element.surge.index.4">
        function <span class="apidocSignatureSpan">surge.index.</span>4
        <span class="apidocSignatureSpan">(req, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">4 = function (req, next){
  if (req.argv.help || req.argv.h) {
    helpers
      .log()
      .log("  Surge".bold, "â€“ Single-command web publishing.", ("(v" + req.pkg.version + ")"). grey)
      .log()
      .log("  Usage:".grey)
      .log("    surge [options]")
      .log()
      .log("  Options:".grey)
      .log("    -p, --project       path to projects asset directory (./)")
      .log("    -d, --domain        domain of your project (&lt;random&gt;."+ req.config.platform +")")
      .log("    -a, --add           adds user to list of collaborators (email address)")
      .log("    -r, --remove        removes user from list of collaborators (email address)")
      .log("    -V, --version       show the version number")
      .log("    -h, --help          show this help message")
      .log()
      .log("  Shorthand usage:".grey)
      .log("    surge [project path] [domain]")
      .log()
      .log("  Additional commands:".grey)
      .log("    surge whoami        show who you are logged in as")
      .log("    surge logout        expire local token")
      .log("    surge login         only performs authentication step")
      .log("    surge list          list all domains you have access to")
      .log("    surge teardown      tear down a published project")
      .log()
      .log("  Guides:".grey)
      .log("    Getting started     " + "surge.sh/help/getting-started-with-surge".underline.grey)
      .log("    Custom domains      " + "surge.sh/help/adding-a-custom-domain".underline.grey)
      .log("    Additional help     " + "surge.sh/help".underline.grey)
      .log()
      .log("  When in doubt, run ".grey + "surge".green.underline + " from within you project directory.".grey)
      .log()

  } else {
    next()
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.index.5" id="apidoc.element.surge.index.5">
        function <span class="apidocSignatureSpan">surge.index.</span>5
        <span class="apidocSignatureSpan">(req, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">5 = function (req, next){
  req.creds = localCreds(req.argv.endpoint || req.config.endpoint || "surge." + req.config.platform).get()
  next()
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.index.6" id="apidoc.element.surge.index.6">
        function <span class="apidocSignatureSpan">surge.index.</span>6
        <span class="apidocSignatureSpan">(req, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">6 = function (req, next){
  //if (req.argv["_"]["0"] === "whoami") {
    if (req.creds) {
      helpers.log("    Logged in as " + req.creds.email.green + ".")
      helpers.log()
    } else {
      helpers.log("    Not currently authenticated.")
      helpers.log()
    }

    process.exit()
  // } else {
  //   next()
  // }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.index.7" id="apidoc.element.surge.index.7">
        function <span class="apidocSignatureSpan">surge.index.</span>7
        <span class="apidocSignatureSpan">(req, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">7 = function (req, next){
  var creds = localCreds(req.argv.endpoint || req.config.endpoint || 'surge.' + req.config.platform).set(null)

  if (req.creds) {
    var filePath = path.join(process.env[(/^win/.test(process.platform)) ? 'USERPROFILE' : 'HOME'], ".netrc")
    helpers.log("    Token removed from " + filePath.grey + " file.")
  } else {
    helpers.log("    Not currently authenticated.")
  }

  next()

}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.index.8" id="apidoc.element.surge.index.8">
        function <span class="apidocSignatureSpan">surge.index.</span>8
        <span class="apidocSignatureSpan">(req, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">8 = function (req, next){
  if (req.creds) {
    req.authed = true
    next()
    // helpers.fetchToken(req.argv.endpoint)("token", req.creds.token, function(err, obj){
    //   if (err) {
    //     localCreds(req.argv.endpoint).set(null)
    //     req.creds  = null
    //     req.authed = false
    //     next()
    //     //auth(req, next)
    //   } else {
    //     req.creds  = localCreds(req.argv.endpoint).set(obj.email, obj.token)
    //     req.authed = true
    //     next()
    //   }
    // })
  } else {
    next()
  }

}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.index.9" id="apidoc.element.surge.index.9">
        function <span class="apidocSignatureSpan">surge.index.</span>9
        <span class="apidocSignatureSpan">(req, next, abort)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">9 = function (req, next, abort){
  var label = "              email:".grey

  if (req.authed) {
    console.log(label, req.creds.email)
    return next()
  } else {
    var ask = function(suggestion){
      req.read({
        silent: false,
        prompt: label,
        default: suggestion,
        edit: true,
        terminal: req.config.terminal,
        output: req.config.output,
        input: req.config.input
      }, function(err, answer){
        if (answer === undefined) return abort("not authenticated.")
        if (!pattern.test(answer)){
          // console.log()
          // console.log("    Invalid".yellow, "-".grey, "please enter valid email address.".grey)
          // console.log()
          return ask(answer)
        } else {
          req.email = answer
          return next()
        }
      })
    }
    return ask()
  }

}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
</body></html>