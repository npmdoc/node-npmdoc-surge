<div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a

        href="https://github.com/sintaxi/surge#readme"

    >surge (v0.19.0)</a>
</h1>
<h4>CDN for front-end developers</h4>
<div class="apidocSectionDiv"><a
    href="#apidoc.tableOfContents"
    id="apidoc.tableOfContents"
><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.surge">module surge</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.surge">
            function <span class="apidocSignatureSpan"></span>surge
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">surge.</span>discovery</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">surge.</span>helpers</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">surge.</span>index</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.surge.discovery">module surge.discovery</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.discovery.setDomainFromArgs">
            function <span class="apidocSignatureSpan">surge.discovery.</span>setDomainFromArgs
            <span class="apidocSignatureSpan">(req, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.discovery.setDomainFromCname">
            function <span class="apidocSignatureSpan">surge.discovery.</span>setDomainFromCname
            <span class="apidocSignatureSpan">(req, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.discovery.suggestDomainFromCname">
            function <span class="apidocSignatureSpan">surge.discovery.</span>suggestDomainFromCname
            <span class="apidocSignatureSpan">(req, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.discovery.suggestDomainFromGenerator">
            function <span class="apidocSignatureSpan">surge.discovery.</span>suggestDomainFromGenerator
            <span class="apidocSignatureSpan">(req, next)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.surge.helpers">module surge.helpers</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.helpers.fetchToken">
            function <span class="apidocSignatureSpan">surge.helpers.</span>fetchToken
            <span class="apidocSignatureSpan">(endpoint)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.helpers.hr">
            function <span class="apidocSignatureSpan">surge.helpers.</span>hr
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.helpers.log">
            function <span class="apidocSignatureSpan">surge.helpers.</span>log
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.helpers.payment">
            function <span class="apidocSignatureSpan">surge.helpers.</span>payment
            <span class="apidocSignatureSpan">(req, stripe_pk, existing)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.helpers.read">
            function <span class="apidocSignatureSpan">surge.helpers.</span>read
            <span class="apidocSignatureSpan">(opts, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.helpers.stacktrace">
            function <span class="apidocSignatureSpan">surge.helpers.</span>stacktrace
            <span class="apidocSignatureSpan">(str, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.helpers.validDomain">
            function <span class="apidocSignatureSpan">surge.helpers.</span>validDomain
            <span class="apidocSignatureSpan">(domain)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.surge.index">module surge.index</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.index.0">
            function <span class="apidocSignatureSpan">surge.index.</span>0
            <span class="apidocSignatureSpan">(req, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.index.1">
            function <span class="apidocSignatureSpan">surge.index.</span>1
            <span class="apidocSignatureSpan">(req, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.index.10">
            function <span class="apidocSignatureSpan">surge.index.</span>10
            <span class="apidocSignatureSpan">(req, next, abort)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.index.11">
            function <span class="apidocSignatureSpan">surge.index.</span>11
            <span class="apidocSignatureSpan">(req, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.index.12">
            function <span class="apidocSignatureSpan">surge.index.</span>12
            <span class="apidocSignatureSpan">(req, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.index.13">
            function <span class="apidocSignatureSpan">surge.index.</span>13
            <span class="apidocSignatureSpan">(req, next, abort)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.index.14">
            function <span class="apidocSignatureSpan">surge.index.</span>14
            <span class="apidocSignatureSpan">(req, next, abort)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.index.15">
            function <span class="apidocSignatureSpan">surge.index.</span>15
            <span class="apidocSignatureSpan">(req, next, abort)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.index.16">
            function <span class="apidocSignatureSpan">surge.index.</span>16
            <span class="apidocSignatureSpan">(req, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.index.17">
            function <span class="apidocSignatureSpan">surge.index.</span>17
            <span class="apidocSignatureSpan">(req, next, abort)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.index.18">
            function <span class="apidocSignatureSpan">surge.index.</span>18
            <span class="apidocSignatureSpan">(req, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.index.19">
            function <span class="apidocSignatureSpan">surge.index.</span>19
            <span class="apidocSignatureSpan">(req, next, abort)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.index.2">
            function <span class="apidocSignatureSpan">surge.index.</span>2
            <span class="apidocSignatureSpan">(req, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.index.20">
            function <span class="apidocSignatureSpan">surge.index.</span>20
            <span class="apidocSignatureSpan">(req, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.index.21">
            function <span class="apidocSignatureSpan">surge.index.</span>21
            <span class="apidocSignatureSpan">(req, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.index.22">
            function <span class="apidocSignatureSpan">surge.index.</span>22
            <span class="apidocSignatureSpan">(req, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.index.3">
            function <span class="apidocSignatureSpan">surge.index.</span>3
            <span class="apidocSignatureSpan">(req, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.index.4">
            function <span class="apidocSignatureSpan">surge.index.</span>4
            <span class="apidocSignatureSpan">(req, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.index.5">
            function <span class="apidocSignatureSpan">surge.index.</span>5
            <span class="apidocSignatureSpan">(req, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.index.6">
            function <span class="apidocSignatureSpan">surge.index.</span>6
            <span class="apidocSignatureSpan">(req, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.index.7">
            function <span class="apidocSignatureSpan">surge.index.</span>7
            <span class="apidocSignatureSpan">(req, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.index.8">
            function <span class="apidocSignatureSpan">surge.index.</span>8
            <span class="apidocSignatureSpan">(req, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.surge.index.9">
            function <span class="apidocSignatureSpan">surge.index.</span>9
            <span class="apidocSignatureSpan">(req, next, abort)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.surge" id="apidoc.module.surge">module surge</a></h1>


    <h2>
        <a href="#apidoc.element.surge.surge" id="apidoc.element.surge.surge">
        function <span class="apidocSignatureSpan"></span>surge
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">surge = function (config){
  config = config || {}

  var ep = config.endpoint
    ? config.endpoint
    : config.platform ? &#x22;https://surge.&#x22; + config.platform : &#x27;https://surge.surge.sh&#x27;

  config.platform = config.platform || &#x22;surge.sh&#x22;

  var options = {
    alias: {
      p: &#x27;project&#x27;,
      d: &#x27;domain&#x27;,
      e: &#x27;endpoint&#x27;,
      a: &#x27;add&#x27;,
      r: &#x27;remove&#x27;
    },
    default: { e: ep }
  }

  var surge = function(args){
    // will be one of:
    // commander, yargs, process.argv.split(2), OR minimist

    var argv = minimist(args, options)
    var cmd  = argv._[0]

    var commands = [&#x22;login&#x22;, &#x22;logout&#x22;, &#x22;whoami&#x22;, &#x22;list&#x22;, &#x22;publish&#x22;, &#x22;teardown&#x22;, &#x22;token&#x22;, &#x22;plus&#x22;, &#x22;ssl&#x22;]

    if (commands.indexOf(cmd) !== -1) {
      argv._.shift()
      surge[cmd]({})(argv)
    } else if(config.default &#x26;&#x26; commands.indexOf(config.default) !== -1 ){
      surge[config.default]({})(argv)
    }
  }

  var stub = function(req, next){ next(); }

  surge.token = function(hooks){
    var hooks = hooks || {}
    var preAuth     = hooks.preAuth       || stub
    var postAuth    = hooks.postAuth      || stub
    var onion = [
      whitelist, endpoint, pkg, help, version, space,
      preAuth, creds, welcome, tokencheck, email, auth, postAuth,
      token, space
    ]
    return function(){
      var argv = parse(arguments[arguments.length -1])
      skin({
        config: config,
        argv: argv,
        read: read
      }, onion)
    }
  }

  surge.login = function(hooks){
    var hooks = hooks || {}
    var preAuth     = hooks.preAuth       || stub
    var postAuth    = hooks.postAuth      || stub
    var onion = [
      whitelist, endpoint, pkg, help, version, space,
      preAuth, creds, welcome, email, auth, postAuth,
      login, space
    ]
    return function(){
      var argv = parse(arguments[arguments.length -1])
      skin({
        config: config,
        argv: argv,
        read: read
      }, onion)
    }
  }

  surge.logout = function(hooks){
    var hooks = hooks || {}
    var onion = [
      whitelist, endpoint, pkg, help, version, space,
      creds, logout, space
    ]
    return function(){
      var argv = parse(arguments[arguments.length -1])
      skin({
        config: config,
        argv: argv,
        read: read
      }, onion)
    }
  }

  surge.publish = function(hooks){
    var hooks = hooks || {}
    var preAuth     = hooks.preAuth       || stub
    var postAuth    = hooks.postAuth      || stub
    var preProject  = hooks.preProject    || stub
    var postProject = hooks.postProject   || stub
    var preSize     = hooks.preSize       || stub
    var postSize    = hooks.postSize      || stub
    var preDomain   = hooks.preDomain     || stub
    var postDomain  = hooks.postDomain    || stub
    var prePublish  = hooks.prePublish    || stub
    var postPublish = hooks.postPublish   || stub
    var onion = [
      whitelist, endpoint, pkg, help, version, space,
      preAuth, creds, welcome, tokencheck, email, auth, postAuth, shorthand,
      preProject, project, postProject,
      preSize, size, postSize,
      preDomain, discovery.setDomainFromCname, discovery.suggestDomainFromGenerator, domain, postDomain,
      prePublish, protocol, deploy, postPublish,
      ipaddress
    ]
    return function(){
      var argv = parse(arguments[arguments.length -1])
      skin({
        config: config,
        argv: argv,
        read: read
      }, onion)
    }
  }

  surge.whoami = function(hooks){
    var hooks = hooks || {}
    var onion = [
      whitelist, endpoint, pkg, help, version, space,
      creds, tokencheck, whoami
    ]
    return function(){
      var argv = parse(arguments[arguments.length -1])
      skin({
        config: config,
        argv: argv,
        read: read
      }, onion)
    }
  }

  surge.list = function(hooks){
    var hooks = hooks || {}
    var preAuth   = hooks.preAuth  || stub
    var postAuth  = hooks.postAuth || stub
    var onion = [
      whitelist, endpoint, pkg, help, version, space,
      preAuth, creds, welcome, tokencheck, email, auth, postAuth,
      list, space
    ]
    return functi ...</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>








</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.surge.discovery" id="apidoc.module.surge.discovery">module surge.discovery</a></h1>


    <h2>
        <a href="#apidoc.element.surge.discovery.setDomainFromArgs" id="apidoc.element.surge.discovery.setDomainFromArgs">
        function <span class="apidocSignatureSpan">surge.discovery.</span>setDomainFromArgs
        <span class="apidocSignatureSpan">(req, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">setDomainFromArgs = function (req, next){
  if (!req.domain &#x26;&#x26; req.argv._[0]) {
    req.domain = req.argv._[0]
  }
  return next()
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.discovery.setDomainFromCname" id="apidoc.element.surge.discovery.setDomainFromCname">
        function <span class="apidocSignatureSpan">surge.discovery.</span>setDomainFromCname
        <span class="apidocSignatureSpan">(req, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">setDomainFromCname = function (req, next){
  if (!req.domain &#x26;&#x26; !req.suggestedDomain) {

    try {
      var cname = fs.readFileSync(path.join(req.project || process.cwd(), &#x22;CNAME&#x22;)).toString()
      req.domain = cname.split(os.EOL)[0].trim()
    } catch(e) {}
  }
  return next()
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.discovery.suggestDomainFromCname" id="apidoc.element.surge.discovery.suggestDomainFromCname">
        function <span class="apidocSignatureSpan">surge.discovery.</span>suggestDomainFromCname
        <span class="apidocSignatureSpan">(req, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">suggestDomainFromCname = function (req, next){

  if (!req.domain &#x26;&#x26; !req.suggestedDomain) {
    try {
      var cname = fs.readFileSync(path.join(req.project || process.cwd(), &#x22;CNAME&#x22;)).toString()
      req.suggestedDomain = cname.split(os.EOL)[0].trim()
    }
    catch(e) {
      // console.log(e) // This will produce a visible error when thereâ€™s no CNAME file
    }
  }

  return next()
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.discovery.suggestDomainFromGenerator" id="apidoc.element.surge.discovery.suggestDomainFromGenerator">
        function <span class="apidocSignatureSpan">surge.discovery.</span>suggestDomainFromGenerator
        <span class="apidocSignatureSpan">(req, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">suggestDomainFromGenerator = function (req, next){
  if (!req.domain &#x26;&#x26; !req.suggestedDomain) {
    req.suggestedDomain = [moniker.choose(), req.config.platform].join(&#x22;.&#x22;)
  }
  return next()
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.surge.helpers" id="apidoc.module.surge.helpers">module surge.helpers</a></h1>


    <h2>
        <a href="#apidoc.element.surge.helpers.fetchToken" id="apidoc.element.surge.helpers.fetchToken">
        function <span class="apidocSignatureSpan">surge.helpers.</span>fetchToken
        <span class="apidocSignatureSpan">(endpoint)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">fetchToken = function (endpoint){
  return function(email, pass, callback){
    var options = {
      &#x27;url&#x27;: url.resolve(urlAddy.parse(endpoint).format(), &#x27;/token&#x27;),
      &#x27;method&#x27;: &#x27;post&#x27;,
      &#x27;auth&#x27;: {
        &#x27;user&#x27;: email,
        &#x27;pass&#x27;: pass || &#x22;&#x22;,
        &#x27;sendImmediately&#x27;: true
      }
    }
    request(options, function(e, r, obj){
      if (e) throw e

      if(r.statusCode == 417){
        console.log()
        console.log(&#x22;     Update Required&#x22;.yellow, &#x22;-&#x22;, obj)
        console.log()
        process.exit(1)
      } else if(r.statusCode == 401){
        var obj = JSON.parse(obj)
        return callback(obj, null)
      }else{
        try {
          var obj = JSON.parse(obj)
          var c   = localCreds(endpoint).set(obj.email, obj.token.replace(os.EOL, &#x22;&#x22;))
          return callback(null, c)
        } catch(e){
          return callback({&#x22;messages&#x22;: [&#x22;password required&#x22;]})
        }

      }
    })
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
      prompt: label,
      silent: true,
      edit: false,
      output: out,
      input: req.config.input
    }, function(err, password){
      if (password === undefined) return abort(&#x22;not authenticated.&#x22;)
      helpers.<span class="apidocCodeKeywordSpan">fetchToken</span>(req.argv.endpoint || req.config.endpoint || &#x27;surge.&#x27
; + req.config.platform)(req.email, password, function(err, obj){
        if (err) {
count++
if (err.hasOwnProperty(&#x22;details&#x22;) &#x26;&#x26; err[&#x22;details&#x22;].hasOwnProperty(&#x22;email&#x22;)) process.exit
(1)

if (count &#x3e;=3) {
  req.read({
    prompt: &#x22;    forgot password?&#x22;.grey,
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.helpers.hr" id="apidoc.element.surge.helpers.hr">
        function <span class="apidocSignatureSpan">surge.helpers.</span>hr
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">hr = function (){
  this.log()
  return this
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

var helpers     = require(&#x22;./util/helpers.js&#x22;)

module.exports = function(req, next){
if (req.creds == null) {
  helpers.log(&#x22;    Welcome to &#x22; + (req.config.name || &#x22;Surge&#x22;).bold + &#x22;! (&#x22; + req.config.platform +&#
x22;)&#x22; )
  if (req.config.name) {
    helpers.log(&#x22;    Powered by Surge&#x22;.grey).<span class="apidocCodeKeywordSpan">hr</span>()
  }
  helpers.log(&#x22;    Please login or create an account by entering your email and password:&#x22;).hr()
} else {
  if(req.config.name){
    helpers.log(&#x22;    &#x22; + req.config.name.bold + &#x22; - &#x22; + (req.config.platform || &#x22;surge.sh&#x22;))
    helpers.log(&#x22;    Powered by Surge&#x22;.grey)
  } else {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.helpers.log" id="apidoc.element.surge.helpers.log">
        function <span class="apidocSignatureSpan">surge.helpers.</span>log
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">log = function (){
  var args = Array.prototype.slice.call(arguments)
  args.unshift(sig)
  args = args.filter(function(n){ return n != undefined });
  console.log.apply(console, args)
  return this
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
#!/usr/bin/env node

var surge = require(&#x22;../&#x22;)({ default: &#x22;publish&#x22; })

surge(process.argv.slice(2))

process.on(&#x27;SIGINT&#x27;, function() {
  console.<span class="apidocCodeKeywordSpan">log</span>(&#x22;\n&#x22;)
  global.ponr == true
    ? console.log(&#x22;    Disconnected&#x22;.green, &#x22;-&#x22;, &#x22;Past point of no return, completing in background.&#x22
;)
    : console.log(&#x22;    Cancelled&#x22;.yellow, &#x22;-&#x22;, &#x22;Upload aborted, publish not initiated.&#x22;)
  console.log()
  process.exit(1)
})
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.helpers.payment" id="apidoc.element.surge.helpers.payment">
        function <span class="apidocSignatureSpan">surge.helpers.</span>payment
        <span class="apidocSignatureSpan">(req, stripe_pk, existing)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">payment = function (req, stripe_pk, existing){
  function card(cc, ep, cv, cb){
    read({
      silent: false,
      prompt: &#x22;        card number:&#x22;.grey,
      default: cc,
      edit: true,
    }, function(er, cc){
      if (cc === undefined) return abort(&#x22;Payment not received.&#x22;)
      read({
        prompt: &#x22;        exp (mo/yr):&#x22;.grey,
        default: ep,
        edit: true,
      }, function(er, ep){
        if (ep === undefined) return abort(&#x22;Payment not received.&#x22;)
        read({
          prompt: &#x22;                cvc:&#x22;.grey,
          default: cv,
          edit: true,
        }, function(er, cv){
          if (cv === undefined) return abort(&#x22;Payment not received.&#x22;)
          request({
            uri: &#x22;https://&#x22;+ stripe_pk +&#x22;:@api.stripe.com/v1/tokens&#x22;,
            method: &#x22;POST&#x22;,
            form: {
              card: {
                number: cc,
                exp_month: ep.split(&#x22;/&#x22;)[0],
                exp_year: ep.split(&#x22;/&#x22;)[1],
                cvc: cv
              }
            }
          }, function(e,r,b) {
            //console.log(&#x22;POST TOKEN RSP:&#x22;, r.statusCode)
            if (r.statusCode == 417){
              console.log()
              console.log(&#x22;     Update Required&#x22;.yellow, &#x22;-&#x22;, obj)
              console.log()
              process.exit(1)
            } else if (r.statusCode == 402){
              var data = JSON.parse(b)
              var msg = &#x22;Card appears to be invalid&#x22;

              if (data.hasOwnProperty(&#x22;error&#x22;))
                msg = data[&#x22;error&#x22;][&#x22;param&#x22;] + &#x22; appears to be invalid. &#x22;

              msg += &#x22;Please try again.&#x22;
              msg = msg.charAt(0).toUpperCase() + msg.substring(1)

              log()
              log(&#x22;      &#x22;, msg.yellow)
              return card(cc, ep, cv, cb)
            } else if(r.statusCode == 200) {
              var data = JSON.parse(b)
              return cb(data.id)
            }
          })

        })
      })
    })
  }

  if (existing !== null) {
    return function(callback){
      read({
        prompt: (&#x22;      Would you like to charge &#x22; +  existing.brand + &#x22; ending in &#x22; + existing.last4.yellow + &#x22;?&#x22;.blue).blue,
        default: &#x22;yes&#x22;,
        edit: true
      }, function(err, reply){
        if (err) console.log(err)

        if (reply === undefined) return abort(&#x22;Payment not received.&#x22;)
        if ([&#x22;Y&#x22;, &#x22;y&#x22;, &#x22;Yes&#x22;, &#x22;yes&#x22;].indexOf(reply) !== -1){
          callback(null)
        } else {
          log()
          log(&#x22;      Please enter new payment method...&#x22; + &#x22; [all payment transfers are PCI compliant]&#x22;.grey)
          card(&#x22;&#x22;, &#x22;&#x22;, &#x22;&#x22;, callback)
        }
      })
    }
  } else {
    return function(callback){
      log()
      log(&#x22;      Please enter your payment info...&#x22; + &#x22; [all payment transfers are PCI compliant]&#x22;.grey)
      card(&#x22;&#x22;, &#x22;&#x22;, &#x22;&#x22;, callback)
    }
  }

}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  payload.perks.forEach(function(perk){
    helpers.log((&#x22;          - &#x22; + perk).blue)
  })
} else {
  helpers.log(msg)
}

helpers.<span class="apidocCodeKeywordSpan">payment</span>(req, payload[&#x22;stripe_pk&#x22;], payload.card)(function(token){
  //console.log(token)
  var uri = url.resolve(req.endpoint, req.domain + &#x22;/subscription&#x22;)
  request({
    uri: uri,
    method: &#x22;PUT&#x22;,
    auth: {
      &#x27;user&#x27;: &#x27;token&#x27;,
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.helpers.read" id="apidoc.element.surge.helpers.read">
        function <span class="apidocSignatureSpan">surge.helpers.</span>read
        <span class="apidocSignatureSpan">(opts, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function read(opts, cb) {
  if (opts.num) {
    throw new Error(&#x27;read() no longer accepts a char number limit&#x27;)
  }

  if (typeof opts.default !== &#x27;undefined&#x27; &#x26;&#x26;
      typeof opts.default !== &#x27;string&#x27; &#x26;&#x26;
      typeof opts.default !== &#x27;number&#x27;) {
    throw new Error(&#x27;default value must be string or number&#x27;)
  }

  var input = opts.input || process.stdin
  var output = opts.output || process.stdout
  var prompt = (opts.prompt || &#x27;&#x27;).trim() + &#x27; &#x27;
  var silent = opts.silent
  var editDef = false
  var timeout = opts.timeout

  var def = opts.default || &#x27;&#x27;
  if (def) {
    if (silent) {
      prompt += &#x27;(&#x3c;default hidden&#x3e;) &#x27;
    } else if (opts.edit) {
      editDef = true
    } else {
      prompt += &#x27;(&#x27; + def + &#x27;) &#x27;
    }
  }
  var terminal = !!(opts.terminal || output.isTTY)

  var m = new Mute({ replace: opts.replace, prompt: prompt })
  m.pipe(output, {end: false})
  output = m
  var rlOpts = { input: input, output: output, terminal: terminal }

  if (process.version.match(/^v0\.6/)) {
    var rl = readline.createInterface(rlOpts.input, rlOpts.output)
  } else {
    var rl = readline.createInterface(rlOpts)
  }


  output.unmute()
  rl.setPrompt(prompt)
  rl.prompt()
  if (silent) {
    output.mute()
  } else if (editDef) {
    rl.line = def
    rl.cursor = def.length
    rl._refreshLine()
  }

  var called = false
  rl.on(&#x27;line&#x27;, onLine)
  rl.on(&#x27;error&#x27;, onError)

  rl.on(&#x27;SIGINT&#x27;, function () {
    rl.close()
    onError(new Error(&#x27;canceled&#x27;))
  })

  var timer
  if (timeout) {
    timer = setTimeout(function () {
      onError(new Error(&#x27;timed out&#x27;))
    }, timeout)
  }

  function done () {
    called = true
    rl.close()

    if (process.version.match(/^v0\.6/)) {
      rl.input.removeAllListeners(&#x27;data&#x27;)
      rl.input.removeAllListeners(&#x27;keypress&#x27;)
      rl.input.pause()
    }

    clearTimeout(timer)
    output.mute()
    output.end()
  }

  function onError (er) {
    if (called) return
    done()
    return cb(er)
  }

  function onLine (line) {
    if (called) return
    if (silent &#x26;&#x26; terminal) {
      output.unmute()
      output.write(&#x27;\r\n&#x27;)
    }
    done()
    // truncate the \n at the end.
    line = line.replace(/\r?\n$/, &#x27;&#x27;)
    var isDefault = !!(editDef &#x26;&#x26; line === def)
    if (def &#x26;&#x26; !line) {
      isDefault = true
      line = def
    }
    cb(null, line, isDefault)
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  var count = 0
  var label = &#x22;           password:&#x22;.grey

  var auth = function(){
var out = req.config.output
if (out) out.isTTY = false

req.<span class="apidocCodeKeywordSpan">read</span>({
  prompt: label,
  silent: true,
  edit: false,
  output: out,
  input: req.config.input
}, function(err, password){
  if (password === undefined) return abort(&#x22;not authenticated.&#x22;)
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.helpers.stacktrace" id="apidoc.element.surge.helpers.stacktrace">
        function <span class="apidocSignatureSpan">surge.helpers.</span>stacktrace
        <span class="apidocSignatureSpan">(str, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">stacktrace = function (str, options){
  var lineno  = options.lineno  || -1
  var context = options.context || 8
  var context = context = context / 2
  var lines   = (os.EOL + str).split(os.EOL)
  var start   = Math.max(lineno - context, 1)
  var end     = Math.min(lines.length, lineno + context)

  if(lineno === -1) end = lines.length

  var pad     = end.toString().length

  var context = lines.slice(start, end).map(function(line, i){
    var curr = i + start
    return (curr == lineno ? &#x27; &#x3e; &#x27; : &#x27;   &#x27;)
      + Array(pad - curr.toString().length + 1).join(&#x27; &#x27;)
      + curr
      + &#x27;| &#x27;
      + line
  }).join(os.EOL)

  return context
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...


if (payload.hasOwnProperty(&#x22;type&#x22;) &#x26;&#x26; payload.type === &#x22;error&#x22;) {
  console.log()
  console.log()
  helpers.log(&#x22;   Processing Error:&#x22;.yellow, payload.error.filename).log()

  console.log(helpers.<span class="apidocCodeKeywordSpan">stacktrace</span>(payload.error.stack, { lineno: payload.error.lineno }))
  helpers.log()
  console.log(&#x22;  &#x22;, payload.error.message)

  console.log()
  process.exit(1)
  req.status = req.status || &#x22;Compile Error&#x22;
} else
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.helpers.validDomain" id="apidoc.element.surge.helpers.validDomain">
        function <span class="apidocSignatureSpan">surge.helpers.</span>validDomain
        <span class="apidocSignatureSpan">(domain)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">validDomain = function (domain) {
  if (domain &#x26;&#x26; (isDomain(domain) === true || isDomain(urlAddy(domain).host) === true)) {
    return true
  } else {
    return false
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
module.exports = function(req, next, abort){
var label = &#x22;             domain:&#x22;.grey

// try {
//   req.domain = req.argv.domain || fs.readFileSync(path.join(req.project, &#x22;CNAME&#x22;)).toString()
//   req.domain = req.domain.split(os.EOL)[0].trim()

//   if (!helpers.<span class="apidocCodeKeywordSpan">validDomain</span>(req.domain)) {
//     return getDomain(req.domain, next)
//   } else {
//     console.log(label, req.domain)
//     return next()
//   }
// } catch(e) {
//   return getDomain(moniker.choose() + &#x22;.surge.sh&#x22;)   // prompt with a suggestion
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.surge.index" id="apidoc.module.surge.index">module surge.index</a></h1>


    <h2>
        <a href="#apidoc.element.surge.index.0" id="apidoc.element.surge.index.0">
        function <span class="apidocSignatureSpan">surge.index.</span>0
        <span class="apidocSignatureSpan">(req, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">0 = function (req, next){
  var commands = [&#x27;h&#x27;,&#x27;b&#x27;, &#x27;d&#x27;,&#x27;e&#x27;,&#x27;a&#x27;,&#x27;r&#x27;,&#x27;v&#x27;,&#x27;V&#x27;,&#x27;p&#x27;,&#x27;endpoint&#x27;,&#x27;project&#x27;,&#x27;domain&#x27;,&#x27;add&#x27;,&#x27;remove&#x27;,&#x27;version&#x27;,&#x27;verbose&#x27;,&#x27;token&#x27;,&#x27;
help&#x27;,&#x27;pem&#x27;, &#x27;build&#x27;,&#x27;$0&#x27;,&#x27;_&#x27;];

  var args = [];
  for (param in req.argv) {
    args.push(param);
  }

  var filteredSet = args.filter(function(n){ return (commands.indexOf(n) === -1) });

  if (filteredSet.length != 0) {
    helpers.log()
    helpers.log(&#x22;       surge: `--&#x22; + filteredSet[0] + &#x22;` is not a surge command.&#x22;).hr()
  } else {
    next()
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.index.1" id="apidoc.element.surge.index.1">
        function <span class="apidocSignatureSpan">surge.index.</span>1
        <span class="apidocSignatureSpan">(req, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">1 = function (req, next){
  req.endpoint = parse(req.argv.endpoint || req.config.endpoint || &#x22;surge.&#x22; + req.config.platform)
  next()
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.index.10" id="apidoc.element.surge.index.10">
        function <span class="apidocSignatureSpan">surge.index.</span>10
        <span class="apidocSignatureSpan">(req, next, abort)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">10 = function (req, next, abort){
  var count = 0
  var label = &#x22;           password:&#x22;.grey

  var auth = function(){
    var out = req.config.output
    if (out) out.isTTY = false

    req.read({
      prompt: label,
      silent: true,
      edit: false,
      output: out,
      input: req.config.input
    }, function(err, password){
      if (password === undefined) return abort(&#x22;not authenticated.&#x22;)
      helpers.fetchToken(req.argv.endpoint || req.config.endpoint || &#x27;surge.&#x27; + req.config.platform)(req.email, password, function
(err, obj){
        if (err) {
          count++
          if (err.hasOwnProperty(&#x22;details&#x22;) &#x26;&#x26; err[&#x22;details&#x22;].hasOwnProperty(&#x22;email&#x22;)) process.exit(1)

          if (count &#x3e;=3) {
            req.read({
              prompt: &#x22;    forgot password?&#x22;.grey,
              default: &#x22;yes&#x22;,
              terminal: req.config.terminal,
              output: req.config.output,
              input: req.config.input
            }, function(err, reply){
              if (reply == &#x22;yes&#x22; || reply == &#x22;y&#x22; || reply == &#x22;Y&#x22;) {

                var options = {
                  &#x27;url&#x27;: url.resolve(req.endpoint, &#x22;/token/reset/&#x22; + req.email),
                  &#x27;method&#x27;: &#x27;post&#x27;
                }

                request(options, function(e, r, obj){
                  if (e) throw e
                  if (r.statusCode == 201) {
                    console.log()
                    console.log(&#x22;    Password Recovery&#x22;.yellow, &#x22;- reset instructions sent to&#x22;, req.email.green)
                    console.log()
                    process.exit(1)
                  } else {
                    console.log()
                    console.log(&#x22;    Oops&#x22;.red, &#x22;- something went wrong trying to reset your password.&#x22;)
                    console.log()
                    process.exit(1)
                  }
                })
              } else {
                console.log()
                console.log(&#x22;    Aborted&#x22;.yellow, &#x22;- no password reset sent.&#x22;, req.email.green)
                console.log()
                process.exit(1)
              }


            })
          } else {
            return auth()
          }
        } else {
          req.creds = localCreds(req.argv.endpoint || req.config.endpoint || &#x27;surge.&#x27; + req.config.platform).set(obj.email, obj.
token)
          return next()
        }
      })
    })
  }

  if (req.authed) {
    console.log(&#x22;              token:&#x22;.grey, &#x22;*****************&#x22;.grey)
    return next()
  } else {
    return auth()
  }

}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.index.11" id="apidoc.element.surge.index.11">
        function <span class="apidocSignatureSpan">surge.index.</span>11
        <span class="apidocSignatureSpan">(req, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">11 = function (req, next){
  helpers.log()
  helpers.log(&#x22;    Logged in as &#x22; + req.creds.email.green + &#x22;.&#x22;)
  next()

  //helpers.log(&#x22;              token: &#x22;.grey + req.creds.token)

}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.index.12" id="apidoc.element.surge.index.12">
        function <span class="apidocSignatureSpan">surge.index.</span>12
        <span class="apidocSignatureSpan">(req, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">12 = function (req, next){

  var options = {
    &#x27;url&#x27;: url.resolve(req.endpoint, &#x27;/list&#x27;),
    &#x27;method&#x27;: &#x27;get&#x27;,
    &#x27;auth&#x27;: {
      &#x27;user&#x27;: &#x22;token&#x22;,
      &#x27;pass&#x27;: req.creds.token,
      &#x27;sendImmediately&#x27;: true
    }
  }

  request(options, function(e, r, obj){
    if (e) throw e
    var list = JSON.parse(obj)
    console.log()
    if (list.length != 0) {
      list.forEach(function(project){
        console.log(&#x22;      &#x22; + project)
      })
    } else {
      console.log(&#x22;    Empty&#x22;.yellow, &#x22;- No Projects found.&#x22;)
    }
    next()
  })

}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.index.13" id="apidoc.element.surge.index.13">
        function <span class="apidocSignatureSpan">surge.index.</span>13
        <span class="apidocSignatureSpan">(req, next, abort)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">13 = function (req, next, abort){

  var plus = function(domain){
    var options = {
      &#x27;url&#x27;: url.resolve(req.endpoint, domain + &#x22;/subscription&#x22;),
      &#x27;method&#x27;: &#x27;get&#x27;,
      &#x27;auth&#x27;: {
        &#x27;user&#x27;: &#x22;token&#x22;,
        &#x27;pass&#x27;: req.creds.token,
        &#x27;sendImmediately&#x27;: true
      }
    }

    request(options, function(e, r, obj){
      if (e) throw e

      var payload = JSON.parse(obj)

      var msg = &#x22;      Project requires the &#x22;.blue  + payload.plan.name.yellow + &#x22; plan. &#x22;.blue + (&#x22;$&#x22; + (payload.plan.amount /
100) + &#x22;/mo&#x22;).yellow + &#x22; (cancel anytime).&#x22;.blue

      helpers.log()
      if (payload.hasOwnProperty(&#x22;perks&#x22;)) {
        helpers.log(msg += &#x22; This plan provides...&#x22;.blue)
        payload.perks.forEach(function(perk){
          helpers.log((&#x22;          - &#x22; + perk).blue)
        })
      } else {
        helpers.log(msg)
      }

      helpers.payment(req, payload[&#x22;stripe_pk&#x22;], payload.card)(function(token){
        var uri = url.resolve(req.endpoint, domain + &#x22;/subscription&#x22;)
        request({
          uri: uri,
          method: &#x22;PUT&#x22;,
          auth: {
            &#x27;user&#x27;: &#x27;token&#x27;,
            &#x27;pass&#x27;: req.creds.token,
            &#x27;sendImmediately&#x27;: true
          },
          form: {
            plan: payload.plan,
            token: token
          }
        }, function(e,r,b){
          if (r.statusCode == 201) {
            if (token === null) console.log()
            var sub = JSON.parse(b)
            console.log(&#x22;               plan:&#x22;.grey, sub.plan.name)
            console.log()
            console.log((&#x22;      You are now upgraded to &#x22; + sub.plan.name + &#x22;!&#x22;).green)
            console.log()
          } else if (r.statusCode == 200) {
            var sub = JSON.parse(b)
            console.log(&#x22;               plan:&#x22;.grey, sub.plan.name)
            console.log()
            console.log((&#x22;      No charge created. You are already upgraded to &#x22; + sub.plan.name + &#x22;!&#x22;).green)
            console.log()
          } else {
            console.log(r.statusCode)
          }
        })
      })
      //process.exit()
    })

  }

  return plus(parseUrl(req.domain).hostname)

}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.index.14" id="apidoc.element.surge.index.14">
        function <span class="apidocSignatureSpan">surge.index.</span>14
        <span class="apidocSignatureSpan">(req, next, abort)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">14 = function (req, next, abort){

    var upload = function(req, next, abort){
      var uri = url.resolve(req.endpoint, path.join(req.domain, &#x22;ssl&#x22;))
      var handshake = request.put(uri, { &#x22;version&#x22; : req.pkg.version })

      // apply basic auth
      handshake.auth(&#x22;token&#x22;, req.creds.token, true)

      // catch errors
      handshake.on(&#x27;error&#x27;, function(d){
        console.log(d)
      })

      // split replies on new line
      handshake.pipe(split())

      // output result
      handshake.on(&#x22;data&#x22;, function(data){
        var payload = JSON.parse(data.toString())
        if (payload.hasOwnProperty(&#x22;type&#x22;) &#x26;&#x26; payload[&#x22;type&#x22;] == &#x22;collect&#x22;){
          var msg = &#x22;      Project requires the &#x22;.blue  + payload.plan.name.yellow + &#x22; plan. &#x22;.blue + (&#x22;$&#x22; + (payload.plan.amount
 / 100) + &#x22;/mo&#x22;).yellow + &#x22; (cancel anytime).&#x22;.blue
          helpers.log()
          if (payload.hasOwnProperty(&#x22;perks&#x22;)) {
            helpers.log(msg += &#x22; This plan provides...&#x22;.blue)
            payload.perks.forEach(function(perk){
              helpers.log((&#x22;          - &#x22; + perk).blue)
            })
          } else {
            helpers.log(msg)
          }
          helpers.payment(req, payload[&#x22;stripe_pk&#x22;], payload.card)(function(token){
            var uri = url.resolve(req.endpoint, req.domain + &#x22;/subscription&#x22;)
            request({
              uri: uri,
              method: &#x22;PUT&#x22;,
              auth: {
                &#x27;user&#x27;: &#x27;token&#x27;,
                &#x27;pass&#x27;: req.creds.token,
                &#x27;sendImmediately&#x27;: true
              },
              form: {
                plan: payload.plan,
                token: token
              }
            }, function(e,r,b){
              if (r.statusCode == 201) {
                //if (token === null) console.log()
                //next()
                //var sub = JSON.parse(b)
                //console.log(&#x22;               plan:&#x22;.grey, sub.plan.name)
              }
            })
          })
        } else if (payload.hasOwnProperty(&#x22;type&#x22;) &#x26;&#x26; payload[&#x22;type&#x22;] == &#x22;subscription&#x22;){
          // if (payload.data) {
          //   console.log(&#x22;               plan:&#x22;.grey, payload.data.plan.name)
          // } else {
          //   console.log(&#x22;               plan:&#x22;.grey, &#x22;Free&#x22;)
          // }
        } else if (payload.hasOwnProperty(&#x22;type&#x22;) &#x26;&#x26; payload[&#x22;type&#x22;] == &#x22;msg&#x22;){
          console.log()
          if (payload.payload[&#x22;status&#x22;] == &#x22;ok&#x22;) {
            console.log(&#x22;    Success&#x22;.green, &#x22;-&#x22;, payload.payload[&#x22;msg&#x22;])
          } else {
            console.log(&#x22;    Error&#x22;.yellow, &#x22;-&#x22;, payload.payload[&#x22;msg&#x22;])
          }
          console.log()
        }

      })

      // done
      handshake.on(&#x22;end&#x22;, function(){
        // console.log()
        // console.log(&#x22;   Success!&#x22;.green, &#x22;-&#x22;, &#x22;ssl cert has been added to&#x22;, req.domain)
        // console.log()
        // process.exit()
      })

      handshake.on(&#x22;response&#x22;, function(rsp){
        console.log()
        // if (rsp.statusCode == 403) {
        //   helpers.log()
        //   helpers.log(&#x22;    Unauthorized&#x22;.yellow + &#x22; - you do not have publish access to&#x22;, req.domain)
        //   helpers.log()
        //   process.exit()
        // } else if (rsp.statusCode == 400) {
        //   helpers.log()
        //   helpers.log(&#x22;    SSL Fail&#x22;.red, &#x22;-&#x22;, &#x22;pem file is invalid.&#x22;)
        //   helpers.log()
        //   process.exit()
        // } else if (rsp.statusCode == 202) {
        //   helpers.log()
        //   helpers.log(&#x22;    SSL Pass&#x22;.green, &#x22;-&#x22;, &#x22;your pem file has been added to&#x22;, req.domain)
        //   helpers.log()
        //   process.exit()
        // }
      })

      var pem = fs.createReadStream(req.pem)
      pem.pipe(handshake)
    }


    var mPem = function(req, next, abort){
      var label = &#x22;           pem file:&#x22;.grey
      var pemPath
      var getPem = function(placeholder){
        req.read({
          prompt: label,
          default: placeholder,
          edit: true,
          terminal: req.config.terminal,
          output: req.config.output,
          input: req.config.input
        }, function(err, pem){
          if ...</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.index.15" id="apidoc.element.surge.index.15">
        function <span class="apidocSignatureSpan">surge.index.</span>15
        <span class="apidocSignatureSpan">(req, next, abort)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">15 = function (req, next, abort){

  var remove = function(domain){
    var options = {
      &#x27;url&#x27;: url.resolve(req.endpoint, domain),
      &#x27;method&#x27;: &#x27;delete&#x27;,
      &#x27;auth&#x27;: {
        &#x27;user&#x27;: &#x22;token&#x22;,
        &#x27;pass&#x27;: req.creds.token,
        &#x27;sendImmediately&#x27;: true
      }
    }

    request(options, function(e, r, obj){
      if (e) throw e

      if (r.statusCode == 200 || r.statusCode == 204 || r.statusCode == 210) {
        helpers.log()
        helpers.log(&#x22;    Success&#x22;.green + &#x22; - &#x22; + domain + &#x22; has been removed.&#x22;)
        helpers.log()
        process.exit()
      } else if (r.statusCode == 403) {
        helpers.log()
        helpers.log(&#x22;    Aborted&#x22;.yellow + &#x22; - unable to remove&#x22;, domain)
        helpers.log()
        process.exit(1)
      } else {
        helpers.log()
        helpers.log(obj)
        helpers.log()
        process.exit()
      }
    })
  }

  return remove(parseUrl(req.domain).host)

}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.index.16" id="apidoc.element.surge.index.16">
        function <span class="apidocSignatureSpan">surge.index.</span>16
        <span class="apidocSignatureSpan">(req, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">16 = function (req, next){
  req.project = req.argv.project || req.argv.p || req.argv[&#x22;_&#x22;][0] || null
  req.domain  = req.argv.domain  || req.argv.d || req.argv[&#x22;_&#x22;][1] || null
  next()
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.index.17" id="apidoc.element.surge.index.17">
        function <span class="apidocSignatureSpan">surge.index.</span>17
        <span class="apidocSignatureSpan">(req, next, abort)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">17 = function (req, next, abort){
  var label = &#x22;       project path:&#x22;.grey

  if (req.project || req.argv.project || req.argv[&#x22;_&#x22;][0]) {
    req.project = req.project || path.resolve(req.argv.project || req.argv[&#x22;_&#x22;][0] || &#x22;&#x22;)

    fs.exists(req.project, function(exists){
      if (exists) {
        helpers.log(&#x22;       project path:&#x22;.grey, req.project)
        next()
      } else {
        helpers.log()
        helpers.log(&#x22;    Aborted&#x22;.yellow, &#x22;-&#x22;, &#x22;No such file or directory.&#x22;)
        helpers.log(&#x22;   &#x22;, req.project.red)
        helpers.log()
        process.exit(1)
      }
    })
  } else {
    var ask = function(suggestion){
      req.read({
        silent: false,
        prompt: label,
        default: suggestion,
        edit: true,
        terminal: req.config.terminal,
        output: req.config.output,
        input: req.config.input
      }, function(err, projectPath){
        if (projectPath === undefined) return abort(&#x22;publishing not initiated.&#x22;)
        if (!fs.existsSync(path.resolve(projectPath))){
          console.log(&#x22;                    &#x22;, &#x22;please enter valid project path...&#x22;.grey)
          return ask(projectPath)
        } else {
          req.project = path.resolve(projectPath)
          return next()
        }
      })
    }

    var x = path.resolve(&#x22;./&#x22;)
    return ask(path.join(x, path.sep))
  }

}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.index.18" id="apidoc.element.surge.index.18">
        function <span class="apidocSignatureSpan">surge.index.</span>18
        <span class="apidocSignatureSpan">(req, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">18 = function (req, next){
  //process.stdout.write(&#x22;               size:&#x22;.grey, &#x22;checking...&#x22;)
  process.stdout.write(&#x22;               size: &#x22;.grey)

  req.projectSize = 0;
  req.fileCount = 0
  var project = fsReader({ &#x27;path&#x27;: req.project, ignoreFiles: [&#x22;.surgeignore&#x22;] })
  project.addIgnoreRules(ignore)

  project.on(&#x22;child&#x22;, function (c) {
    fs.lstat(c.path, function(err, stats) {
      req.projectSize += stats.size
      if (!stats.isDirectory()) req.fileCount++
    })
  }).on(&#x22;close&#x22;, function(){
    helpers.log(req.fileCount + &#x22; files,&#x22;, humanFileSize(req.projectSize))
    next()
  })

}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.index.19" id="apidoc.element.surge.index.19">
        function <span class="apidocSignatureSpan">surge.index.</span>19
        <span class="apidocSignatureSpan">(req, next, abort)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">19 = function (req, next, abort){
  var label = &#x22;             domain:&#x22;.grey

  // try {
  //   req.domain = req.argv.domain || fs.readFileSync(path.join(req.project, &#x22;CNAME&#x22;)).toString()
  //   req.domain = req.domain.split(os.EOL)[0].trim()

  //   if (!helpers.validDomain(req.domain)) {
  //     return getDomain(req.domain, next)
  //   } else {
  //     console.log(label, req.domain)
  //     return next()
  //   }
  // } catch(e) {
  //   return getDomain(moniker.choose() + &#x22;.surge.sh&#x22;)   // prompt with a suggestion
  // }

  function getDomain(suggestion){
    helpers.read({
      silent: false,
      prompt: label,
      default: suggestion || &#x22;&#x22;,
      edit: true,
      terminal: req.config.terminal,
      output: req.config.output,
      input: req.config.input
    }, function(err, domain){
      if (domain === undefined) return abort(&#x22;Please try again with a valid domain name.&#x22;)
      if (err || !helpers.validDomain(domain)) {
        console.log(&#x22;                    &#x22;, &#x22;Please enter valid domain nameâ€¦&#x22;.grey)
        return getDomain(domain)
      }
      req.domain = domain
      return next()
    })
  }

  if (helpers.validDomain(req.domain)) {
    console.log(label, req.domain)
    next()
  } else {
    if (req.domain == &#x22;_&#x22;){
      req.domain = [moniker.choose(), req.config.platform].join(&#x22;.&#x22;)
      console.log(label, req.domain)
      next()
    } else {
      getDomain(req.suggestedDomain)
    }

  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.index.2" id="apidoc.element.surge.index.2">
        function <span class="apidocSignatureSpan">surge.index.</span>2
        <span class="apidocSignatureSpan">(req, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">2 = function (req, next){
  req.pkg = require(__dirname + &#x22;/../../package.json&#x22;)
  next()
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.index.20" id="apidoc.element.surge.index.20">
        function <span class="apidocSignatureSpan">surge.index.</span>20
        <span class="apidocSignatureSpan">(req, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">20 = function (req, next){
  req.ssl = null
  var u   = url.parse(req.domain)

  if (u.protocol !== null) {
    if (u.protocol == &#x22;https:&#x22;) req.ssl = true
    if (u.protocol == &#x22;http:&#x22;) req.ssl = false
    req.domain = u.hostname
  }

  next()
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.index.21" id="apidoc.element.surge.index.21">
        function <span class="apidocSignatureSpan">surge.index.</span>21
        <span class="apidocSignatureSpan">(req, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">21 = function (req, next){


<span class="apidocCodeCommentSpan">  /**
   * Some useful metadata
   */
</span>
  var headers = {
    &#x22;version&#x22; : req.pkg.version,
    &#x22;file-count&#x22;: req.fileCount,
    &#x22;project-size&#x22;: req.projectSize
  }


  /**
   * Collaborators to add
   */

  if (req.argv.a)
    headers[&#x22;add&#x22;] = req.argv.a;


  /**
   * Collaborators to remove
   */

  if (req.argv.r)
    headers[&#x22;rem&#x22;] = req.argv.r;


  /**
   * Perform build on server
   */

  if (req.argv.build)
    headers[&#x22;build&#x22;] = req.argv.build;


  /**
   * Force Protocol?
   */

  if (req.ssl !== null)
    headers[&#x22;ssl&#x22;] = req.ssl

  /**
   * Progress Bars
   */

  var progress = {}


  /**
   * Our upload &#x22;data&#x22; handle
   */

  var tick = function(tick){
    if (Object.keys(progress).length &#x3e; 1) global.ponr = true

    //try {

      try {
        var payload  = JSON.parse(tick.toString())
      } catch(e) {
        //console.log(e)
        return;
      }


      if (payload.hasOwnProperty(&#x22;type&#x22;) &#x26;&#x26; payload.type === &#x22;error&#x22;) {
        console.log()
        console.log()
        helpers.log(&#x22;   Processing Error:&#x22;.yellow, payload.error.filename).log()

        console.log(helpers.stacktrace(payload.error.stack, { lineno: payload.error.lineno }))
        helpers.log()
        console.log(&#x22;  &#x22;, payload.error.message)

        console.log()
        process.exit(1)
        req.status = req.status || &#x22;Compile Error&#x22;
      } else

      if (payload.hasOwnProperty(&#x22;type&#x22;) &#x26;&#x26; payload.type === &#x22;users&#x22;) {
        helpers.log(&#x22;              users:&#x22;.grey, payload.users.join(&#x22;, &#x22;))
      } else

      if (payload.hasOwnProperty(&#x22;type&#x22;) &#x26;&#x26; payload.type === &#x22;collect&#x22;) {
        var msg = &#x22;      Project requires the &#x22;.blue  + payload.plan.name.yellow + &#x22; plan. &#x22;.blue + (&#x22;$&#x22; + (payload.plan.amount /
100) + &#x22;/mo&#x22;).yellow + &#x22; (cancel anytime).&#x22;.blue

        helpers.log()
        if (payload.hasOwnProperty(&#x22;perks&#x22;)) {
          helpers.log(msg += &#x22; This plan provides...&#x22;.blue)
          payload.perks.forEach(function(perk){
            helpers.log((&#x22;          - &#x22; + perk).blue)
          })
        } else {
          helpers.log(msg)
        }

        helpers.payment(req, payload[&#x22;stripe_pk&#x22;], payload.card)(function(token){
          //console.log(token)
          var uri = url.resolve(req.endpoint, req.domain + &#x22;/subscription&#x22;)
          request({
            uri: uri,
            method: &#x22;PUT&#x22;,
            auth: {
              &#x27;user&#x27;: &#x27;token&#x27;,
              &#x27;pass&#x27;: req.creds.token,
              &#x27;sendImmediately&#x27;: true
            },
            form: {
              plan: payload.plan,
              token: token
            }
          }, function(e,r,b){
            if (r.statusCode == 201 || r.statusCode == 200) {
              console.log()
              //if (token === null) console.log()
              //var sub = JSON.parse(b)
              //console.log(&#x22;               plan:&#x22;.grey, sub.plan.name)
            }
          })
        })

        // prompt for user
      } else
      if (payload.hasOwnProperty(&#x22;type&#x22;) &#x26;&#x26; payload.type === &#x22;ip&#x22;) {
        if (payload.data) {
          console.log(&#x22;         IP Address:&#x22;.grey, payload.data.ip)
        }
      } else
      if (payload.hasOwnProperty(&#x22;type&#x22;) &#x26;&#x26; payload.type === &#x22;event_registration&#x22;) {
        if (payload.data) {
          console.log()
          console.log((&#x22;             &#x22; + payload.data.event.name + &#x22; is set!&#x22;).bold)

          if (payload.data.event.start)
            console.log(&#x22;              start:&#x22;.grey, payload.data.event.start)

          if (payload.data.event.end)
            console.log(&#x22;                end:&#x22;.grey, payload.data.event.end)

          if (payload.data.event.website)
            console.log(&#x22;            website:&#x22;.grey, payload.data.event.website)

          if (payload.data.event.email)
            console.log(&#x22;              email:&#x22;.grey, payload.data.event.email)

          if (payload.data.event.twitter)
            console.log(&#x22;            twitter:&#x22;.grey, payload.data.event.twitter)
        }
      } else


      if (payload.hasOwnProperty(&#x22;type&#x22;) &#x26;&#x26; payload.type === &#x22;event_participant&#x22;) { ...</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.index.22" id="apidoc.element.surge.index.22">
        function <span class="apidocSignatureSpan">surge.index.</span>22
        <span class="apidocSignatureSpan">(req, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">22 = function (req, next){

  if (req.status) {

  } else {
    console.log()
    console.log(&#x22;    Success!&#x22;.green + &#x22; Project is published and running at &#x22; + req.domain.green.underline)
    console.log(&#x22;&#x22;)
  }

  next()
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.index.3" id="apidoc.element.surge.index.3">
        function <span class="apidocSignatureSpan">surge.index.</span>3
        <span class="apidocSignatureSpan">(req, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">3 = function (req, next){
  if (req.argv.version || req.argv.V) {
    console.log(pkg.version)
  } else {
    next()
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.index.4" id="apidoc.element.surge.index.4">
        function <span class="apidocSignatureSpan">surge.index.</span>4
        <span class="apidocSignatureSpan">(req, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">4 = function (req, next){
  if (req.argv.help || req.argv.h) {
    helpers
      .log()
      .log(&#x22;  Surge&#x22;.bold, &#x22;â€“ Single-command web publishing.&#x22;, (&#x22;(v&#x22; + req.pkg.version + &#x22;)&#x22;). grey)
      .log()
      .log(&#x22;  Usage:&#x22;.grey)
      .log(&#x22;    surge [options]&#x22;)
      .log()
      .log(&#x22;  Options:&#x22;.grey)
      .log(&#x22;    -p, --project       path to projects asset directory (./)&#x22;)
      .log(&#x22;    -d, --domain        domain of your project (&#x3c;random&#x3e;.&#x22;+ req.config.platform +&#x22;)&#x22;)
      .log(&#x22;    -a, --add           adds user to list of collaborators (email address)&#x22;)
      .log(&#x22;    -r, --remove        removes user from list of collaborators (email address)&#x22;)
      .log(&#x22;    -V, --version       show the version number&#x22;)
      .log(&#x22;    -h, --help          show this help message&#x22;)
      .log()
      .log(&#x22;  Shorthand usage:&#x22;.grey)
      .log(&#x22;    surge [project path] [domain]&#x22;)
      .log()
      .log(&#x22;  Additional commands:&#x22;.grey)
      .log(&#x22;    surge whoami        show who you are logged in as&#x22;)
      .log(&#x22;    surge logout        expire local token&#x22;)
      .log(&#x22;    surge login         only performs authentication step&#x22;)
      .log(&#x22;    surge list          list all domains you have access to&#x22;)
      .log(&#x22;    surge teardown      tear down a published project&#x22;)
      .log()
      .log(&#x22;  Guides:&#x22;.grey)
      .log(&#x22;    Getting started     &#x22; + &#x22;surge.sh/help/getting-started-with-surge&#x22;.underline.grey)
      .log(&#x22;    Custom domains      &#x22; + &#x22;surge.sh/help/adding-a-custom-domain&#x22;.underline.grey)
      .log(&#x22;    Additional help     &#x22; + &#x22;surge.sh/help&#x22;.underline.grey)
      .log()
      .log(&#x22;  When in doubt, run &#x22;.grey + &#x22;surge&#x22;.green.underline + &#x22; from within you project directory.&#x22;.grey)
      .log()

  } else {
    next()
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.index.5" id="apidoc.element.surge.index.5">
        function <span class="apidocSignatureSpan">surge.index.</span>5
        <span class="apidocSignatureSpan">(req, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">5 = function (req, next){
  req.creds = localCreds(req.argv.endpoint || req.config.endpoint || &#x22;surge.&#x22; + req.config.platform).get()
  next()
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.index.6" id="apidoc.element.surge.index.6">
        function <span class="apidocSignatureSpan">surge.index.</span>6
        <span class="apidocSignatureSpan">(req, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">6 = function (req, next){
  //if (req.argv[&#x22;_&#x22;][&#x22;0&#x22;] === &#x22;whoami&#x22;) {
    if (req.creds) {
      helpers.log(&#x22;    Logged in as &#x22; + req.creds.email.green + &#x22;.&#x22;)
      helpers.log()
    } else {
      helpers.log(&#x22;    Not currently authenticated.&#x22;)
      helpers.log()
    }

    process.exit()
  // } else {
  //   next()
  // }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.index.7" id="apidoc.element.surge.index.7">
        function <span class="apidocSignatureSpan">surge.index.</span>7
        <span class="apidocSignatureSpan">(req, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">7 = function (req, next){
  var creds = localCreds(req.argv.endpoint || req.config.endpoint || &#x27;surge.&#x27; + req.config.platform).set(null)

  if (req.creds) {
    var filePath = path.join(process.env[(/^win/.test(process.platform)) ? &#x27;USERPROFILE&#x27; : &#x27;HOME&#x27;], &#x22;.netrc&#x22;)
    helpers.log(&#x22;    Token removed from &#x22; + filePath.grey + &#x22; file.&#x22;)
  } else {
    helpers.log(&#x22;    Not currently authenticated.&#x22;)
  }

  next()

}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.index.8" id="apidoc.element.surge.index.8">
        function <span class="apidocSignatureSpan">surge.index.</span>8
        <span class="apidocSignatureSpan">(req, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">8 = function (req, next){
  if (req.creds) {
    req.authed = true
    next()
    // helpers.fetchToken(req.argv.endpoint)(&#x22;token&#x22;, req.creds.token, function(err, obj){
    //   if (err) {
    //     localCreds(req.argv.endpoint).set(null)
    //     req.creds  = null
    //     req.authed = false
    //     next()
    //     //auth(req, next)
    //   } else {
    //     req.creds  = localCreds(req.argv.endpoint).set(obj.email, obj.token)
    //     req.authed = true
    //     next()
    //   }
    // })
  } else {
    next()
  }

}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.surge.index.9" id="apidoc.element.surge.index.9">
        function <span class="apidocSignatureSpan">surge.index.</span>9
        <span class="apidocSignatureSpan">(req, next, abort)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">9 = function (req, next, abort){
  var label = &#x22;              email:&#x22;.grey

  if (req.authed) {
    console.log(label, req.creds.email)
    return next()
  } else {
    var ask = function(suggestion){
      req.read({
        silent: false,
        prompt: label,
        default: suggestion,
        edit: true,
        terminal: req.config.terminal,
        output: req.config.output,
        input: req.config.input
      }, function(err, answer){
        if (answer === undefined) return abort(&#x22;not authenticated.&#x22;)
        if (!pattern.test(answer)){
          // console.log()
          // console.log(&#x22;    Invalid&#x22;.yellow, &#x22;-&#x22;.grey, &#x22;please enter valid email address.&#x22;.grey)
          // console.log()
          return ask(answer)
        } else {
          req.email = answer
          return next()
        }
      })
    }
    return ask()
  }

}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
